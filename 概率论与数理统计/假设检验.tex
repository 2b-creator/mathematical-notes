\chapter{假设检验}
\section{假设检验的基本概念}
\subsection{假设检验的基本思想}
\DefineConcept{假设检验}问题是指判断样本与样本、样本与总体的差异是不是由系统误差引起.
其一般形式是：总体\(X \sim N(\mu,\sigma_0^2)\)，其中\(\sigma_0^2\)已知.自总体\(X\)取得样本\(\AutoTuple{X}{n}\)及样本观测值\(\AutoTuple{x}{n}\).
当测量不存在系统误差时，测量值的分布的均值\(\mu\)应等于真实值\(\mu_0\).故可提出两个相互对立的假设：\[
H_0: \mu=\mu_0; \qquad H_1: \mu\neq\mu_0.
\]其中\(H_0\)称为\DefineConcept{原假设}，\(H_1\)称为\DefineConcept{备选假设}.这样，判断测量是否存在系统误差又等价于判断\(H_0\)成立还是\(H_1\)成立.

注意样本均值\(\overline{X}\)是总体期望\(\mu\)的无偏估计，因此\begin{enumerate}
\item 若\(H_0\)成立，即\(\mu=\mu_0\)，故\(\overline{X}\)与\(\mu_0\)偏差的绝对值\(\abs{\overline{X}-\mu_0}\)取值应相对较小，它的取值反映的是样本均值所产生的抽样误差；
\item 若\(H_1\)成立，即\(\mu\neq\mu_0\)，则\(\abs{\overline{X}-\mu_0}\)取值应相对较大，它的取值主要反映的是\(\mu\neq\mu_0\)所产生的系统误差.
\end{enumerate}

因此判断\(H_0\)成立还是\(H_1\)成立转化为判断\(\abs{\overline{X}-\mu_0}\)取值的相对大小.

而\(\abs{\overline{X}-\mu_0}\)取值的相对大小又与\[
\abs{U}=\frac{\abs{\overline{X}-\mu_0}}{\sigma_0 / \sqrt{n}}
\]的相对大小一致.这就需要一个临界值，以判断\(\abs{U}\)的相对大小.

我们取一个很小的正数\(\alpha\)（如0.01、0.05），称之为\DefineConcept{显著性水平}.
假定\(H_0\)成立，此时有\[
U = \frac{\overline{X}-\mu_0}{\sigma_0 / \sqrt{n}} \sim N(0,1),
\]从而有\begin{align*}
P(\abs{U}>u_{1-\frac{\alpha}{2}})
&=P(U>u_{1-\frac{\alpha}{2}})+P(U<-u_{1-\frac{\alpha}{2}}) \\
&=1 - P(U \leq u_{1-\frac{\alpha}{2}}) + P(U<u_{\frac{\alpha}{2}}) \\
&=1 - (1-\frac{\alpha}{2}) + \frac{\alpha}{2}
=\alpha.
\end{align*}
这样，推出事件\((\abs{U}>u_{1-\frac{\alpha}{2}})\)是一个小概率事件.根据小概率事件在一次试验中是几乎不可能发生的小概率原理，因此在\(H_0\)成立的假定下，事件\((\abs{U}>u_{1-\frac{\alpha}{2}})\)是几乎不可能发生的.

如果经过计算发现\(\abs{u}=\frac{\abs{\overline{x}-\mu_0}}{\sigma_0 / \sqrt{n}}>u_{1-\frac{\alpha}{2}}\)成立，即小概率事件\((\abs{U}>u_{1-\frac{\alpha}{2}})\)竟然发生了，由小概率原理说明这个事件发生的概率并不小，这与推导出该事件是小概率事件矛盾，也就说明前面假定\(H_0\)成立是错误的，从而拒绝\(H_0\)成立而接受\(H_1\)成立，或者说测量存在系统误差.

但要注意，假设检验的结论与显著性水平\(\alpha\)密切相关.不同的显著性水平下可能得出相反的结论.因此，假设检验的结论必须说明是在什么样的显著性水平\(\alpha\)下得到的.

上面的推导方法反映了一般假设检验的思想方法.假设检验又叫\DefineConcept{显著性检验}，其中\(U\)叫做\DefineConcept{检验统计量}；\(u_{1-\frac{\alpha}{2}}\)叫做临界值；\(W=\{\abs{U}>u_{1-\frac{\alpha}{2}}\}\)叫做检验的\DefineConcept{拒绝域}.

一般地，拒绝域在原假设\(H_0\)成立时是一个小概率事件.当样本观测值代入检验统计量使得这个小概率事件发生了，则应拒绝\(H_0\)成立，从而接受备选假设\(H_1\)成立.若样本观测值代入时这个小概率事件没有发生，则接受\(H_0\)成立.

\subsection{双侧检验与单侧检验}
在上一小节中，备选假设\(H_1\)为\(\mu\neq\mu_0\)，\(\mu\)位于\(\mu_0\)两端.这样的检验叫做\DefineConcept{双侧检验}.注意此检验的拒绝域\(W=\{\abs{U}>u_{1-\frac{\alpha}{2}}\}\)也位于两端.

但实际情况中也常常遇到单侧检验问题.
例如，若我们已经知道测量值不会偏低，
则我们关心的是测量值是否有偏大的系统误差，
即应该检验\[
	H_0: \mu=\mu_0
	\quad\text{或}\quad
	\mu\leq\mu_0;
\]\[
	H_1: \mu>\mu_0.
\]
这样的检验，因备择假设\(H_1\)中\(\mu\)位于\(\mu_0\)右侧，
所以这个检验叫做\DefineConcept{右侧检验}.
对于总体\(X \sim N(\mu,\sigma_0^2)\)，显著性水平为\(\alpha\)时，
检验统计量为\(U = \frac{\overline{X}-\mu_0}{\sigma_0 / \sqrt{n}}\)，
拒绝域为\(W=\{U>u_{1-\alpha}\}\).
需要注意的是，不同的两种原假设\(\mu=\mu_0\)和\(\mu\leq\mu_0\)在实际意义上虽有区分，
但其检验统计量与拒绝域都相同，故在理论上没有区分.

相反地，如果原假设为\(H_0: \mu=\mu_0\ \text{（或}\mu\geq\mu_0\text{）}\)，备择假设为\(H_1: \mu<\mu_0\)，即备择假设\(H_1\)中\(\mu\)位于\(\mu_0\)左侧，则称之为\DefineConcept{左侧检验}.对于总体\(X \sim N(\mu,\sigma_0^2)\)，显著性水平为\(\alpha\)时，检验统计量为\(U = \frac{\overline{X}-\mu_0}{\sigma_0 / \sqrt{n}}\)，拒绝域为\(W=\{U<-u_{1-\alpha}\}\).

右侧检验与左侧检验合称\DefineConcept{单侧检验}.

\subsection{两类错误}
由前所述，拒绝域是依据小概率原理推出的.
但“几乎不可能发生”不等于“一定不发生”，
因此假设检验的结论有可能是错误的.这种错误有两类：

第一类错误叫做“弃真”，即当\(H_0\)确实是正确的，
但检验统计量的值却落入了拒绝域，我们就拒绝了\(H_0\).

第二类错误叫做“取伪”，即当\(H_0\)确实是错误的，
但检验统计量的值却未落入拒绝域，我们就接受了\(H_0\).

犯第一类错误的概率是不大于显著性水平\(\alpha\)的.
例如，在右侧检验时，对于总体\(X \sim N(\mu,\sigma_0^2)\)，
检验统计量为\(U = \frac{\overline{X}-\mu_0}{\sigma_0 / \sqrt{n}} \sim N(0,1)\)，
原假设\(H_0: \mu\leq\mu_0\)为真时，
拒绝\(H_0\)的概率为\[
	P\left(U=\frac{\overline{X}-\mu_0}{\sigma_0 / \sqrt{n}}>u_{1-\alpha}\right)
	\leq P\left(U=\frac{\overline{X}-\mu}{\sigma_0 / \sqrt{n}}>u_{1-\alpha}\right)
	= \alpha.
\]

犯第二类错误的概率记为\(\beta\).
当\(H_1\)为真时，\(\frac{\overline{X}-\mu}{\sigma_0/\sqrt{n}} \sim N(0,1)\)，且\(\mu>\mu_0\)，
故不拒绝\(H_0\)的概率为\[
	\beta=P\left(U=\frac{\overline{X}-\mu_0}{\sigma_0/\sqrt{n}} \leq u_{1-\alpha}\right).
\]

\(\beta\)的值一般不容易求出.
但是\(E(U)=\frac{\mu-\mu_0}{\sigma_0/\sqrt{n}}\).
如\cref{figure:假设检验.两类错误}，
我们有\(\mu=\mu_0\)和\(\mu=\mu_1>\mu_0\)时\(U\)的密度曲线，
可知\(\alpha+\beta\neq1\)，
且\(\alpha\)越小\(\beta\)越大，反之亦然.

\begin{figure}[ht]
	\centering
	\begin{tikzpicture}
		\begin{axis}[
			axis y line=none,
			axis x line=middle,
			enlarge x limits=0.05,
			xscale=2,
		]
			\def\plotNDPDF#1#2#3{\addplot[color=#3,samples=100,smooth,domain=-7:7]{exp(-(x-#1)^2/(2*#2^2))/(sqrt(2*pi)*#2)}}%
			\plotNDPDF{-1}{2}{blue};
			\plotNDPDF{2}{1.6}{orange};
			\draw[black!30](1,1)--(1,0)node[below,black]{\(u_{1-\alpha}\)};
			\draw(-1,5pt)--(-1,0);
			\draw(2,5pt)--(2,0);
		\end{axis}
	\end{tikzpicture}
	\caption{}
	\label{figure:假设检验.两类错误}
\end{figure}

这样，我们不能同时使两类错误的概率都减小.
一般的做法有两种.
第一种是取定显著性水平\(\alpha\)，
再增大样本容量\(n\)，
使得\(\beta\)减少.
第二种是根据实际问题看哪一种错误后果严重，
再选取\(\alpha\)的大小.
如果第一类错误后果严重，则\(\alpha\)可取小一些，
例如\(\alpha=0.01\)，\(\alpha=0.05\)等.
如果第二类错误后果严重，则\(\alpha\)可取大一些，
例如\(\alpha=0.05\)，\(\alpha=0.1\)等.

\subsection{假设检验的一般步骤}
根据前面的讨论，我们可以总结出假设检验的一般步骤：\begin{enumerate}
	\item 根据实际问题，提出原假设\(H_0\)和备择假设\(H_1\)；
	\item 选取适当的检验统计量，并在原假设\(H_0\)成立的条件下，确定检验统计量的分布；
	\item 选取显著性水平\(\alpha\)，并根据统计量的分布查表确定临界值，
	从而得到检验的拒绝域，这里要注意拒绝域的方向与备择假设的方向是一致的；
	\item 根据样本观测值计算检验统计量的观测值，并与临界值比较，
	再对拒绝或接受原假设\(H_0\)作出判断.
\end{enumerate}

\section{正态总体下参数的假设检验}
\subsection{一个正态总体下参数的假设检验}
设\(X \sim N(\mu,\sigma^2)\)，
\(\AutoTuple{X}{n}\)是来自总体\(X\)的样本.
分别记\(\overline{X},S^2\)为样本均值和样本方差.

\begin{enumerate}
	\item \(\sigma^2=\sigma_0^2\)已知时，\(\mu\)的检验

	当原假设为\(H_0: \mu=\mu_0\)，且\(H_0\)成立时，
	由前面的讨论，可知此时检验统计量\[
		U = \frac{\overline{X}-\mu_0}{\sigma_0/\sqrt{n}} \sim N(0,1),
	\]
	且对给定的显著性水平\(\alpha\)，
	我们已经知道各种备择假设下检验的拒绝域
	（见\cref{table:假设检验.一个正态总体均值的假设检验表}）.
	这种检验因检验统计量是\(U\)，故叫做“\(u\)检验”.

	\item \(\sigma^2\)未知时，\(\mu\)的检验

	当原假设为\(H_0: \mu=\mu_0\)，且\(H_0\)成立时，
	由抽样分布定理可知，%7.5
	检验统计量\[
		t = \frac{\overline{X}-\mu_0}{S/\sqrt{n}} \sim t(n-1),
	\]
	当显著性水平\(\alpha\)取定后，
	注意到对各种备择假设下拒绝域的方向与备择假设方向一致，
	与\(\sigma^2\)已知时推导的过程类似，
	可得各种备择假设下检验的拒绝域
	（见\cref{table:假设检验.一个正态总体均值的假设检验表}）.
	这种检验因检验统计量为\(t\)，故叫做“\(t\)检验”.

	\item \(\mu\)未知时，\(\sigma^2\)的检验.

	当原假设为\(H_0: \sigma^2=\sigma_0^2\)，
	且\(H_0\)成立时，
	由抽样分布定理可知，%7.4
	检验统计量\[
		\x=\frac{(n-1)S^2}{\sigma_0^2} \sim \x(n-1).
	\]
	当显著性水平\(\alpha\)取定后，\cref{table:假设检验.一个正态总体方差的卡方检验}
	给出了各种备择假设下检验的拒绝域.
	这种检验统计量为\(\x\)，故叫做“\(\x\)检验”.
\end{enumerate}

\begin{table}[ht]
	\centering
	\begin{tabular}{c*3{|c}}
		\hline
		\multirow{2}{*}{\(H_0\)}
		& \multirow{2}{*}{\(H_1\)}
		& \(\sigma^2\)已知
		& \(\sigma^2\)未知 \\ \cline{3-4}
		&& \multicolumn{2}{c}{在显著性水平\(\alpha\)下关于\(H_0\)的拒绝域} \\ \hline
		\multirow{3}{*}{\(\mu=\mu_0\)}
		& \(\mu\neq\mu_0\)
		& \(\abs{U}>u_{1-\frac{\alpha}{2}}\)
		& \(\abs{t}>t_{1-\frac{\alpha}{2}}(n-1)\) \\ \cline{2-4}
		& \(\mu>\mu_0\)
		& \(U>u_{1-\alpha}\)
		& \(t>t_{1-\alpha}(n-1)\) \\ \cline{2-4}
		& \(\mu<\mu_0\)
		& \(U<-u_{1-\alpha}\)
		& \(t<-t_{1-\alpha}(n-1)\) \\ \hline
	\end{tabular}
	\caption{一个正态总体均值的假设检验表}
	\label{table:假设检验.一个正态总体均值的假设检验表}
\end{table}

\begin{table}[ht]
	\centering
	\begin{tabular}{c*2{|c}}
		\hline
		\(H_0\) & \(H_1\) & 显著性水平\(\alpha\)下关于\(H_0\)的拒绝域 \\ \hline
		\multirow{3}{*}{\(\sigma^2=\sigma_0^2\)} & \(\sigma^2\neq\sigma_0^2\)
		& \(\x<\x_{\frac{\alpha}{2}}(n-1)\)或\(\x>\x_{1-\frac{\alpha}{2}}(n-1)\) \\ \cline{2-3}
		& \(\sigma^2>\sigma_0^2\)
		& \(\x>\x_{1-\alpha}(n-1)\) \\ \cline{2-3}
		& \(\sigma^2<\sigma_0^2\)
		& \(\x<\x_\alpha(n-1)\) \\
		\hline
	\end{tabular}
	\caption{一个正态总体方差的\(\x\)检验}
	\label{table:假设检验.一个正态总体方差的卡方检验}
\end{table}

\begin{example}
%@see: 《概率论与数理统计》（陈鸿建、赵永红、翁洋） P234. 例9.2
已知某种元件的使用寿命（单位：\(h\)）服从标准差为\(\sigma=120\ h\)的正态分布.
按要求，该种元件的使用寿命不低于\(1800\ h\)才算合格.
现在从一批元件中随机抽取36件，测得其平均寿命为\(1750\ h\).
判断这批元件是否合格（\(\alpha=0.05\)）？
\begin{solution}
由题意有，一批元件的平均寿命不低于\(1800\ h\)才算合格，
故应检验假设\[
	H_0: \mu\geq\mu_0=1800, \qquad
	H_1: \mu<1800.
\]
这是一个左侧检验.
因元件寿命\(X \sim N(\mu,\sigma^2)\)，
且\(\sigma=120\ h\)已知，故应用\(u\)检验.

因为\(\alpha=0.05\)，则查表可知\(u_{1-\alpha}=u_{0.95}=1.645\).
又已知\(\sigma=120\ h\)，\(n=36\)，\(\overline{x}=1750\ h\)，\(\mu_0=1800\ h\)，
于是，检验统计量为\[
	u = \frac{\overline{x}-\mu_0}{\sigma_0/\sqrt{n}}
	= \frac{1750-1800}{120/\sqrt{36}}
	= -2.5 < -u_{1-\alpha} = -1.645.
\]
因为\(u=-2.5\)落入拒绝域，拒绝\(H_0\)，可以认定这批元件不合格.
\end{solution}
\end{example}

\subsection{两个正态总体下参数的假设检验}
设总体\(X \sim N(\mu_1,\sigma_1^2)\)，总体\(Y \sim N(\mu_2,\sigma_2^2)\).
从两个总体中分别抽取两组独立样本\(\AutoTuple{X}{n_1}\)和\(\AutoTuple{Y}{n_2}\)，
将两组样本的样本均值、样本方差分别记为\(\overline{X},\overline{Y},S_1^2,S_2^2\).

\begin{enumerate}
	\item \(\sigma_1^2,\sigma_2^2\)已知时，\(\mu_1=\mu_2\)的检验

	当原假设\(H_0: \mu_1=\mu_2\)成立时，
	由抽样分布定理可知，%7.7
	此时检验统计量\[
		U = \frac{\overline{X}-\overline{Y}}{\sqrt{
			\frac{\sigma_1^2}{n_1}
			+\frac{\sigma_2^2}{n_2}
		}}
		\sim N(0,1),
	\]
	从而对各种备择假设有此时\(u\)检验的拒绝域（\cref{table:假设检验.两个正态总体均值的假设检验表}）.

	\item \(\sigma_1^2=\sigma_2^2=\sigma^2\)，但\(\sigma^2\)未知时，\(\mu_1=\mu_2\)的检验

	当原假设\(H_0: \mu_1=\mu_2\)成立时，
	由抽样分布定理可知，%7.8
	此时检验统计量\[
		T = \frac{\overline{X}-\overline{Y}}{
			S_w \sqrt{\frac{1}{n_1}+\frac{1}{n_2}}
		}
		\sim t(n_1+n_2-2),
	\]
	其中\[
		S_w = \sqrt{\frac{(n_1-1)S_1^2+(n_2-1)S_2^2}{n_1+n_2-2}},
	\]
	从而对各种备择假设有此时\(t\)检验的拒绝域（\cref{table:假设检验.两个正态总体均值的假设检验表}）.

	\item \(\mu_1,\mu_2\)未知时，方差\(\sigma_1^2=\sigma_2^2\)的检验

	当原假设\(H_0: \sigma_1^2=\sigma_2^2\)成立时，
	由抽样分布定理可知，%7.9
	此时检验统计量\[
		F=\frac{S_1^2}{S_2^2}
		\sim F(n_1-1,n_2-1).
	\]
	从而对各种备择假设可得到检验的拒绝域（\cref{table:假设检验.两个正态总体方差的假设检验表}）.
	这个检验由于检验统计量为\(F\)，称为“\(F\)检验”.
\end{enumerate}

\begin{table}[ht]
	\centering
	\begin{tabular}{c*3{|c}}
		\hline
		\multirow{2}{*}{\(H_0\)}
		& \multirow{2}{*}{\(H_1\)}
		& \(\sigma_1^2,\sigma_2^2\)已知
		& \(\sigma_1^2,\sigma_2^2\)未知，\(\sigma_1^2=\sigma_2^2\) \\ \cline{3-4}
		&& \multicolumn{2}{c}{在显著性水平\(\alpha\)下关于\(H_0\)的拒绝域} \\ \hline
		\multirow{3}{*}{\(\mu_1=\mu_2\)}
		& \(\mu_1\neq\mu_2\)
		&  \(\abs{U}>u_{1-\frac{\alpha}{2}}\)
		& \(\abs{T}>t_{1-\frac{\alpha}{2}}(n_1+n_2-2)\) \\ \cline{2-4}
		& \(\mu_1>\mu_2\)
		& \(U>u_{1-\alpha}\)
		& \(T>t_{1-\alpha}(n_1+n_2-2)\) \\ \cline{2-4}
		& \(\mu_1<\mu_2\)
		& \(U<-u_{1-\alpha}\)
		& \(T<-t_{1-\alpha}(n_1+n_2-2)\) \\
		\hline
	\end{tabular}
	\caption{两个正态总体均值的假设检验表}
	\label{table:假设检验.两个正态总体均值的假设检验表}
\end{table}

\begin{table}[ht]
	\centering
	\begin{tabular}{c*2{|c}}
		\hline
		\(H_0\) & \(H_1\)
		& 显著性水平\(\alpha\)下关于\(H_0\)的拒绝域 \\ \hline
		\multirow{3}{*}{\(\mu_1=\mu_2\)}
		& \(\mu_1\neq\mu_2\)
		& \(F<F_{\frac{\alpha}{2}}(n_1-1,n_2-1)\)
		或\(F>F_{1-\frac{\alpha}{2}}(n_1-1,n_2-1)\) \\ \cline{2-3}
		& \(\mu_1>\mu_2\)
		& \(F>F_{1-\alpha}(n_1-1,n_2-1)\) \\ \cline{2-3}
		& \(\mu_1<\mu_2\)
		& \(F<F_\alpha(n_1-1,n_2-1)\) \\
		\hline
	\end{tabular}
	\caption{两个正态总体方差的假设检验表}
	\label{table:假设检验.两个正态总体方差的假设检验表}
\end{table}
