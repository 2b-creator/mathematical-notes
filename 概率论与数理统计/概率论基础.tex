\chapter{概率论基础}
\section{样本空间与随机事件}
\subsection{随机试验}
\begin{definition}
一个科学实验，或对一个自然现象和社会现象的观察，我们都称为一个试验.
如果一个试验满足以下三个特点，则称之为\textbf{随机试验}：
\begin{enumerate}
\item 可在相同条件下重复进行；
\item 试验的所有可能结果不止一个，且试验前知道一切可能结果；
\item 试验前不知哪一个可能结果出现，试验后能客观确定出现的哪一个结果.
\end{enumerate}
随机试验以后简称为试验.
\end{definition}

\subsection{样本空间与随机事件}
\begin{definition}
一个试验的所有可能结果的集合，称为该试验的\textbf{样本空间}，记作\(\Omega\).
这个试验的任何一个可能结果称为一个\textbf{样本点}，记作\(\omega\).
\end{definition}

样本空间是由试验确定的，它可能是有限集，也可能是无限集；它可以是一维或多维的数集，也可以是抽象的集合.有时为了数学处理方便，样本空间也可形式上扩大，例如把样本空间\([a,b]\)扩大到\([a,+\infty)\)甚至\((-\infty,+\infty)\).

\begin{definition}
样本空间的子集，称为\textbf{随机事件}，简称为\textbf{事件}.
事件常用大写字母\(A,B,C\)等表示.

我们称事件\(A\)在一次试验中发生，当且仅当试验中出现的样本点\(\omega \in A\).
\end{definition}

\begin{definition}
\(\Omega\)本身是\(\Omega\)的子集，它包含所有样本点，称为\textbf{必然事件}，因为在任意一次试验时\(\Omega\)必然发生.

空集\(\emptyset\)是\(\Omega\)的子集，它不包含任何样本点，称为\textbf{不可能事件}，因为在任意一次试验时\(\emptyset\)必不发生.

仅含一个样本点\(\omega\)的事件\(B = \{ \omega \}\)称为\textbf{基本事件}.
\end{definition}

\subsection{事件的关系及运算}
随机事件是样本空间的一个子集，因而可以根据集合论的知识来讨论事件间的关系与运算.

\begin{definition}
设试验的样本空间是\(\Omega\).

\begin{enumerate}
\item 事件的包含与相等

若\(A \subseteq B\)，称事件\(B\)包含事件\(A\)，其概率意义为“若事件\(A\)发生则事件\(B\)一定发生”（或者说，“若事件\(B\)不发生则事件\(A\)一定不发生”）.
若\(A \subseteq B\)且\(B \subseteq A\)，则称事件\(A\)与\(B\)相等，记为\(A = B\)，其概率意义为“事件\(A\)与\(B\)要么同时发生，要么同时不发生”.

\item 事件的和（并）

\(A \cup B\)称为事件\(A\)与\(B\)的和（并）事件，它是由事件\(A\)与\(B\)产生的一个新事件，表示事件\(A\)与\(B\)至少有一个发生的事件.
和事件可以推广到\(\bigcup\limits_{i=1}^n A_i\)与\(\bigcup\limits_{i=1}^{\infty} A_i\)，它们分别表示“有限个事件\(A_1,A_2,\dotsc,A_n\)中至少有一个发生”或“可数无穷个事件\(A_1,A_2,\dotsc,\)中至少有一个发生”的事件.

\item 事件的积（交）

\(A \cap B\)（或记为\(AB\)）称为事件\(A\)与\(B\)的积（交）事件，它表示“事件\(A\)与\(B\)都发生”的事件.
同样地，积事件可以推广到\(\bigcap\limits_{i=1}^n A_i\)与\(\bigcap\limits_{i=1}^{\infty} A_i\)，它们分别表示“有限个事件\(A_1,A_2,\dotsc,A_n\)同时发生”或“可数无穷个事件\(A_1,A_2,\dotsc,\)同时发生”的事件.

\item 事件的差

事件\(A-B\)称为事件\(A\)与\(B\)的差，表示“\(A\)发生而\(B\)不发生”的事件.

\item 互斥（互不相容）事件

若\(AB = \emptyset\)，即“事件\(A\)与\(B\)不可能同时发生”，称事件\(A\)与\(B\)为\textbf{互斥事件}（或\textbf{互不相容事件}）.
需要注意，基本事件之间是两两互斥的.

\item 互逆（互为独立）事件

若事件\(A\)与\(B\)有\(AB = \emptyset\)且\(A \cup B = \Omega\)，则称\(A\)与\(B\)为\textbf{互逆事件}（或\textbf{互为对立事件}），因为此时“\(A\)与\(B\)不可能同时发生，但\(A\)与\(B\)必定有一个会发生”，所以称\(B\)为\(A\)的\textbf{逆事件}（或\textbf{对立事件}），记作\(\overline{A}\)，即“\(A\)不发生”.这时有\(B = \overline{A}\)和\(A = \overline{B}\).

\item 完备事件组

若事件\(A_1,A_2,\dotsc,A_n\)两两互斥，且\(A_1 \cup A_2 \cup \dotsb \cup A_n = \Omega\)，则称\(n\)个事件\(A_1,A_2,\dotsc,A_n\)为一个\textbf{完备事件组}，或称之为对样本空间\(\Omega\)的一个\textbf{有限划分}.可见，完备事件组是互为对立事件的一个延伸.
\end{enumerate}
\end{definition}

\begin{property}
\(A \overline{A} = \emptyset\).
\end{property}

\begin{property}
\(A \cup \overline{A} = \Omega\).
\end{property}

\begin{property}
\(A - B = A \overline{B}\).
\end{property}

\begin{property}
\(\overline{\overline{A}} = A\).
\end{property}

\begin{theorem}[事件的运算规律]
由于事件实质上是集合，有
\begin{enumerate}
\item \textbf{交换律}：
\(A \cup B = B \cup A\)，\(A B = B A\)；
\item \textbf{结合律}：
\(A \cup (B \cup C) = (A \cup B) \cup C\)，%
\(A \cap (B \cap C) = (A \cap B) \cap C\)；
\item \textbf{分配律}：
\(A \cup (B \cap C) = (A \cup B) \cap (A \cup C)\)，%
\(A \cap (B \cup C) = (A \cap B) \cup (A \cap C)\)；
\item \textbf{对偶律}：
\(\overline{A \cup B} = \overline{A}\ \overline{B}\)，%
\(\overline{AB} = \overline{A} \cup \overline{B}\)，%
\(\overline{\bigcup_{i}{A_i}} = \bigcap_{i}{\overline{A_i}}\)，%
\(\overline{\bigcap_{I}{A_i}} = \bigcup_{i}{\overline{A_i}}\).
\end{enumerate}
\end{theorem}

\section{事件发生的概率}

\subsection{频率的概念及性质}
对于一个事件，除去必然事件与不可能事件外，它在一次试验中有可能发生，也有可能不发生.
为了揭示这些事件内在的统计规律性，往往需要知道这些事件在一次试验中发生的可能性的大小，以便更好地认识客观事物.
比如医学工作者在研制一种新药的过程中，需要做临床试验测试其是否有效，可否投入临床使用.

为了刻画事件在一次试验中发生的可能性，我们首先引入频率的概念.

\begin{definition}
在\(n\)次重复试验中，若事件\(A\)发生了\(k\)次，则称\(k\)为事件\(A\)发生的频数，称\(\frac{k}{n}\)为事件\(A\)发生的频率，记作\(f_n(A)\)，即\[
f_n(A) = \frac{k}{n}.
\]
\end{definition}

\begin{property}
由定义可知，频率有如下性质：\begin{enumerate}
\item \(0 \leqslant f_n(A) \leqslant 1\)；
\item \(f_n(\Omega) = 1\)，\(f_n(\emptyset) = 0\)；
\item 若\(A_1,A_2,\dotsc,A_r\)为\(r\)个两两互斥的事件，则\[
f_n\left( \bigcup_{i=1}^r A_i \right)
= \sum\limits_{i=1}^r f_n(A_i).
\]
\end{enumerate}
\end{property}

由于事件\(A\)在\(n\)次试验中发生的频率是\(A\)发生的频数与试验次数\(n\)之比，频率大小表示了\(A\)发生的频繁程度.频率越大，事件\(A\)在\(n\)次试验中发生得越频繁，就意味着\(A\)在一次试验中发生的可能性越大.因此，频率在一定程度上可以反映事件发生可能性的大小.

但是，另一方面频率具有不客观性.我们来看下面列出的数据：
\begin{example}
历史上，许多著名的统计学家做过“抛硬币”试验，得到如下数据：
\begin{center}
\begin{tabular}{c|c|c|c}
\hline
试验者 & 抛硬币次数\(n\) & 正面朝上次数\(n_A\) & 频率\(f_n(A)\) \\ \hline
Buffon & 4 040 & 2 048 & 0.506 9 \\
Fisher & 10 000 & 4 979 & 0.497 9 \\
Pearson & 12 000 & 6 019 & 0.501 6 \\
Pearson & 24 000 & 12 012 & 0.500 5 \\ \hline
\end{tabular}
\end{center}
\end{example}
可以看出，频率具有波动性.当试验次数\(n\)不同时，频率不相同（事实上，即便试验次数\(n\)相同，不同的实验者得到的频率也未必相同）.
进一步仔细观察这两组数据可以发现，当\(n\)较小时，频率波动较大；而当\(n\)较大时，频率波动越来越小，且频率总稳定在一个客观数量附近，例如“抛硬币”试验中频率的稳定值是\(0.5\).

\subsection{概率的公理化定义及性质}
在实践中，我们通常不可能，也无必要对每个事件做大量的试验来获取频率的稳定值.历史上，数学家是在不同的概率模型下给出事件概率的计算公式，再抽象地公理化地定义概率.

\begin{definition}
设\(\Omega\)为一个试验的样本空间.
对\(\Omega\)中任意一个事件\(A\)，%
对应一个实数\(P(A)\).
若这个集合函数\(P(\cdot)\)满足以下三个条件，%
则称\(P(A)\)为事件\(A\)发生的\textbf{概率}：
\begin{enumerate}
\item 非负性：\begin{equation}
P(A) \geqslant 0;
\end{equation}
\item 规范性：\begin{equation}
P(\Omega) = 1;
\end{equation}
\item 可列可加性：若\(A_1,A_2,\dotsc,A_n,\dotsc\)可列个两两互斥的事件，则\begin{equation}
P\left(\bigcup_{i=1}^{\infty}{A_i}\right)
= \sum\limits_{i=1}^{\infty}{P(A_i)}.
\end{equation}
\end{enumerate}
\end{definition}
这个概率的公理化定义是苏联科学家柯尔莫哥洛夫在1933年给出的.

由概率的定义，可得概率有如下性质：
\begin{property}
\begin{equation}
P(\emptyset) = 0.
\end{equation}
\end{property}

\begin{property}[有限可加性]
若\(n\)个事件\(A_1,A_2,\dotsc,A_n\)两两互斥，则\begin{equation}
P\left(\bigcup_{i=1}^{n}{A_i}\right)
= \sum\limits_{i=1}^n{P(A_i)}.
\end{equation}
\end{property}

\begin{property}
\begin{equation}
P(\overline{A}) = 1 - P(A).
\end{equation}
\end{property}

\begin{property}[概率的减法]
\begin{equation}
P(A - B) = P(A) - P(AB).
\end{equation}

特别地，若\(B \subseteq A\)，有
\begin{equation}
P(A - B) = P(A) - P(B),
\end{equation}
且
\begin{equation}
P(A) \geqslant P(B).
\end{equation}

\begin{proof}
由事件\(A\)满足：\[
A = A \Omega
= A(B+\overline{B})
= AB+A\overline{B},
\]故\[
P(A) = P(AB)+P(A\overline{B}),
\]进而有\[
P(A-B) = P(A\overline{B}) = P(A) - P(AB).
\]

当\(B \subseteq A\)时，%
\(B = BB \subseteq AB\)；
又由\(AB \subseteq B\)，%
所以\(AB = B\)，%
进而有\[
P(A-B) = P(A) - P(B).
\qedhere
\]
\end{proof}
\end{property}

\begin{property}
对任意事件\(A\)，有\begin{equation}
P(A) \leqslant 1.
\end{equation}
\end{property}

\begin{theorem}[概率的加法]
对任意两事件\(A\)、\(B\)，有\begin{equation}
P(A \cup B) = P(A) + P(B) - P(AB).
\end{equation}
\end{theorem}

\begin{corollary}
对任意三事件\(A\)，\(B\)，\(C\)，有\begin{equation}
\begin{aligned}
P(A \cup B \cup C)
&= P(A) + P(B) + P(C) \\
&- P(AB) - P(AC) - P(BC) \\
&+ P(ABC).
\end{aligned}
\end{equation}
\end{corollary}

\begin{theorem}
对任意两事件\(A_1,A_2\)，有\begin{equation}
P(A \cup A_1) \leqslant P(A) + P(B).
\end{equation}
\end{theorem}

\begin{corollary}[布尔不等式]
对任意多个事件\(A_1,A_2,\dotsc\)，不等式\begin{equation}\label{equation:概率论基础.布尔不等式}
P(A_1 \cup A_2 \cup \dotsb)
\leqslant
P(A_1) + P(A_2) + \dotsb
\end{equation}
成立，当且仅当“\(A_1,A_2,\dotsc\)两两互斥”时取“\(=\)”.
\end{corollary}

\section{等可能概型}
在实际问题中，具体找出符合概率公理化定义的集合函数\(P(\cdot)\)，再计算出事件\(A\)的概率\(P(A)\)通常是不容易的.但在等可能概型下，\(P(A)\)的计算却十分简单.

等可能概型是指一个试验中所有的样本点都等可能出现的概率模型.
\subsection{古典概型}
\begin{definition}
若一个随机试验具有以下两个特点：
\begin{enumerate}
\item 试验只有有限个可能结果，即\[
\Omega = \{\omega_1, \omega_2, \dotsc, \omega_n\};
\]

\item 每个可能结果在试验中出现的可能性相等，即\[
P\{\omega_1\} = P\{\omega_2\} = \dotsb = P\{\omega_n\},
\]
\end{enumerate}
这样的随机试验的概率模型称为\textbf{古典概率模型}，简称\textbf{古典概型}.
\end{definition}

因为\(\Omega = \{\omega_1\}\cup\{\omega_2\}\cup\dotsb\cup\{\omega_n\}\)，且基本事件是两两互斥的，从而有\[
1 = P(\Omega) = P\{\omega_1, \omega_2, \dotsc, \omega_n\}
= \sum\limits_{i=1}^n P\{\omega_i\}
= n P\{\omega_1\},
\]得到\[
P\{\omega_1\} = P\{\omega_2\} = \dotsb = P\{\omega_n\} = \frac{1}{n}.
\]

对任一事件\(A\)，为不失一般性，\(A\)总可表为\[
A = \{\omega_{i_1},\omega_{i_2},\dotsc,\omega_{i_k}\}
= \{\omega_{i_1}\}\cup\{\omega_{i_2}\}\cup\dotsb\cup\{\omega_{i_k}\},
\]于是有\[
P(A) = P\{\omega_{i_1}\} + P\{\omega_{i_2}\} + \dotsb + P\{\omega_{i_k}\}
= \frac{k}{n} = \frac{A \text{中的样本点总数}}{\Omega \text{中的样本点总数}}.
\]

这样的概率称为\textbf{古典概率}.

计算古典概率时，应选取适当的随机试验以及样本空间，使其符合古典概率的两个特点.
比如掷一均匀硬币两次，考察出现的面（记正面为T，反面为H），样本空间为\(\Omega_1 = \{ HH, HT, TH, TT \}\)，四个基本事件出现的概率都是\(1/4\).
但若考察正面出现的次数，则样本空间为\(\Omega_2 = \{ 0,1,2 \}\)，这便不是古典概型，因为出现“0次正面”相当于第一个试验出现“TT”，其概率为\(1/4\)；而出现“1次正面”相当于第一个试验出现“HT”或“TH”，其概率为\(1/2\).

\begin{example}
设一个袋中有\(N\)个编号不同的小球.
从袋中\textbf{有放回地}抽取\(r\)次，%
每次一球，这时样本点总数为\(N^r\).
\end{example}

\begin{example}
设一个袋中有\(N\)个编号不同的小球.
从袋中\textbf{不放回地}抽取\(r\)次，%
每次一球，这时样本点总数为\(A_N^r = N(N-1)\dotsb(N-r+1) = \frac{N!}{(N-r)!}\)（\(r \leqslant N\)）.
\end{example}

\begin{example}
设一个袋中有\(N\)个球，其中\(m\)个红球，余下是白球.
从袋中一次取\(n\)个球.这样抽取到的\(n\)个球是无序的，总的抽取结果有\(C_N^n\)种.
而取出的\(n\)个球中恰有\(k\)个红球的样本点总数为\(C_m^k C_{N-m}^{n-k}\)种（\(k=0,1,\dotsc,m\)）.
从而取出\(n\)个球中恰有\(k\)个红球的概率为\[
p_k = \frac{C_m^k C_{N-m}^{n-k}}{C_N^n},
\quad k=0,1,\dotsc,m.
\]
这个概率\(p_k\)称为\textbf{超几何概率}.
\end{example}

\begin{example}[抽签问题]
袋中有\(m\)个白球，\(n\)个黑球，现从中不放回地依次取球，求第\(k\)次（\(1 \leqslant k \leqslant m+n\)）取出的球是白球的概率.
\begin{solution}
设想将第\(i\)次取出的球放入第\(i\)号（\(i=1,2,\dotsc,m+n\)）格子，则所求概率是第\(k\)号格子放白球的概率.所有\(m+n\)个格子放球的方式有\((m+n)!\)种，而当第\(k\)号格子放白球时，不妨先放第\(k\)号格子，再放余下\(m+n-1\)个格子，即共有放球方式\(m(m+n-1)!\)种，于是所求概率为\[
p = \frac{m (m+n-1)!}{(m+n)!} = \frac{m}{m+n}.
\]
\end{solution}
这个例子表明抽签的结果与抽签的顺序无关.
\end{example}

\begin{example}
30只元件中有27只一等品，3只二等品.随即将这30只元件均分装入三盒，求：\begin{enumerate}
\item 每盒有一只二等品的概率；
\item 有一盒有三只二等品的概率.
\end{enumerate}
\begin{solution}
30只元件平均分到三盒的总分法有\(C_{30}^{10} C_{20}^{10} C_{10}^{10} = \frac{30!}{10! 10! 10!}\)种.
\begin{enumerate}
\item 三只二等品均分到三个盒子的分法有\(3!\)种，再将27只一等品均分到三个盒子的分法有\(C_{27}^9 C_{18}^9 C_9^9 = \frac{27!}{9! 9! 9!}\)种，则\[
P(\text{每盒有一只二等品})=\frac{3! \cdot 27!}{9! 9! 9!} \bigg/ \frac{30!}{10! 10! 10!} \approx 0.2463.
\]
\item 指定一个盒子并将三只二等品装入这个盒子的指定方式有\(3\)种，其余27只一等品的分法（二等品所在盒7只，另外两盒各10只）有\(C_{27}^7 C_{20}^{10} C_{10}^{10} = \frac{27!}{7! 10! 10!}\)种，则\[
P(\text{有一盒有三只二等品}) = \frac{3 \cdot 27!}{7! 10! 10!} \bigg/ \frac{30!}{10! 10! 10!} \approx 0.0887.
\]
\end{enumerate}
\end{solution}
在本例中，我们反复利用以下结果：

将\(n\)个球分成\(k\)组，第\(i\)组恰有\(n_i\)个球（\(i=1,2,\dotsc,k\)）且\(n_1+n_2+\dotsb+n_k=n\)，则所有的分法总数为\begin{equation}
C_n^{n_1} C_{n-n_1}^{n_2} \dotsm C_{n-(n_1+n_2+\dotsb+n_{k-1})}^{n_k}
= \frac{n!}{n_1! n_2! \dotsm n_k!}.
\end{equation}
\end{example}

\subsection{几何概型}
\begin{definition}
一个随机试验，若其所有可能结果“等可能”地出现在一个有界的欧式区域\(\Omega\)内，%
则称这个试验的概率模型为\textbf{几何概型}.
\end{definition}
这时所有可能结果构成一个无限集，从而不能用计数的方法计算事件的概率.

\begin{definition}
如果把\(\Omega\)作为一般的欧式区域，\(m(A)\)作为\(A\)的度量（一维为长度，二维为面积，三维为体积……），%
就得到几何概型下，一般事件\(A\)的概率计算公式：\[
P(A) = \frac{m(A)}{m(\Omega)},
\]称这个概率为\textbf{几何概率}.
\end{definition}
由几何概率的定义，若事件\(B\)的度量为0，则\(B\)的几何概率\(P(B)=0\).但\(B\)不一定是不可能事件.

\begin{example}
随机地在单位圆内掷一点\(M\)，求点\(M\)到原点距离小于\(1/4\)的概率.
\begin{solution}
因为点\(M\)“等可能”地出现在单位圆内，于是\(M\)出现在单位圆内任何一个面积相等的小区域\(A\)内因概率相等而与\(A\)的形态与位置无关.而且\(A\)的概率\(P(A)\)因与\(A\)的面积\(m(A)\)成正比，即\(P(A)=\lambda m(A)\).但是\(1 = P(\Omega) = \lambda m(\Omega)\)，从而有\(\lambda = 1/m(\Omega)\)，于是得到\(P(A) = m(A)/m(\Omega)\).这样，\(M\)到原点距离小于\(1/4\)的概率为\[
p = \frac{\pi (1/4)^2}{\pi \times 1^2} = \frac{1}{16}.
\]
\end{solution}
\end{example}

\begin{example}[会面问题]
甲、乙两人约定在早上7点到8点之间在某处会面，并约定先到者应等候另一人15min，过时即离去，求两人能会面的概率.
\begin{solution}
以\(x\)和\(y\)分别表示甲、乙两人到达约会地点的时间（从7点开始计时，单位：min），则两人所有可能到达时间为\[
\Omega = \Set{ \opair{x,y} \given 0 \leqslant x \leqslant 60, 0 \leqslant y \leqslant 60 }.
\]

设事件\(A\)表示两人能会面，则\[
A = \Set{ \opair{x,y}\in\Omega \given \abs{x-y} \leqslant 15 }.
\]

那么\[
P(A) = \frac{m(A)}{m(\Omega)} = \frac{60^2 - 45^2}{60^2} = \frac{7}{16}.
\]
\end{solution}
\end{example}

\begin{example}[蒲丰（Buffon）投针问题]
设平面上有等距离的平行线.平行线的距离为\(a\).向平面任意投掷一枚长为\(l\)（\(l<a\)）的针，试求针与平行线相交的概率.
\begin{solution}
以\(x\)表示针的中点与最近一条平行线的距离，又以\(\varphi\)表示针与直线间的夹角，则有\[
\Omega = \Set{ \opair{\varphi,x} \given 0 \leqslant \varphi \leqslant \pi, 0 \leqslant x \leqslant a/2 }.
\]令\(A\)为“针与平行线相交”，则\[
A = \Set*{ \opair{\varphi,x}\in\Omega \given x \leqslant \frac{l}{2} \sin\varphi },
\]从而\[
P(A) = \frac{m(A)}{m(\Omega)} = \frac{\int_0^{\pi}\frac{l}{2} \sin\varphi \dd{\varphi}}{\pi \cdot (a/2)} = \frac{2l}{\pi a}.
\]
\end{solution}
\end{example}

\section{条件概率}

\subsection{条件概率的概念}
\begin{definition}
设\(A\)、\(B\)是同一试验的两事件，且\(P(B) > 0\)，称\[
P(A \vert B) = \frac{P(AB)}{P(B)}
\]为“\(B\)发生条件下\(A\)发生的\textbf{条件概率}”，或简称“\(A\)对\(B\)的条件概率”.
\end{definition}

\begin{property}
条件概率有如下性质：\begin{enumerate}
\item \(P(A \vert B) \geqslant 0\)；
\item \(P(\Omega \vert B) = 1\)；
\item 若事件\(A_1,A_2,\dotsc,A_n,\dotsc\)两两互斥，则\[
P\left(\bigcup_{i=1}^{\infty}{A_i} \Bigg\vert B\right)
= \sum\limits_{i=1}^{\infty}{P(A_i \vert B)}.
\]
\end{enumerate}
\begin{proof}
性质3推导如下：当\(A_1,A_2,\dotsc,A_n,\dotsc\)两两互斥的，则\(A_1 B,A_2 B,\dotsc,A_n B,\dotsc\)也两两互斥.从而由条件概率定义及概率的可列可加性，有\begin{align*}
P\left(\bigcup_{i=1}^{\infty}{A_i} \Bigg\vert B\right)
&= P\left[\left(\displaystyle\bigcup_{i=1}^{\infty}{A_i}\right) B\right] \Bigg/ P(B)
= P\left(\displaystyle\bigcup_{i=1}^{\infty}{A_i B}\right) \Bigg/ P(B) \\
&= \sum\limits_{i=1}^{\infty}{\frac{P(A_i B)}{P(B)}}
= \sum\limits_{i=1}^{\infty}{P(A_i \vert B)}.
\qedhere
\end{align*}
\end{proof}
\end{property}

当事件\(B\)给定时，\(P(A \vert B)\)是事件\(A\)的集合函数.而上述三个性质正好是概率定义中三个公理化条件，于是条件概率也是概率.这样，条件概率满足概率的一切性质，如：

\begin{property}
\(P(\overline{A} \vert B) = 1 - P(A \vert B)\).
\end{property}

\begin{property}
\(P(A \cup B \vert C) = P(A \vert C) + P(B \vert C) - P(AB \vert C)\).
\end{property}

\begin{example}
历史资料表明，某地区从某次特大洪水发生以后在30年内发生特大洪水的概率为80\%，在40年内发生特大洪水的概念为85\%.问现在已30年无特大洪水的该地区，在未来10年内将发生特大洪水的概率是多少？
\begin{solution}
设\(A\)表示“该地区从某次特大洪水后30年内无特大洪水”，\(B\)表示“该地区从某次特大洪水后40年内无特大洪水”，则\(P(A) = 0.2\)，\(P(B) = 0.15\).因为\(B \subseteq A\)使得\(AB = B\)，那么所求概率为\[
P(\overline{B} \vert A)
= 1 - P(B \vert A)
= 1 - \frac{P(AB)}{P(A)}
= 1 - \frac{P(B)}{P(A)}
= 1 - \frac{0.15}{0.2}
= 0.25.
\]
\end{solution}
\end{example}

\subsection{乘法公式}
\begin{theorem}[概率的乘法]
当\(P(A) > 0\)，\(P(B) > 0\)，由条件概率的定义有\begin{equation}
P(AB) = P(A) P(B \vert A) = P(B) P(A \vert B),
\end{equation}上式称为\textbf{乘法公式}.

一般地，设\(A_1,A_2,\dotsc,A_n\)是\(n\)个事件，且\(P(A_1 A_2 \dotsm A_{n-1}) > 0\)，则有乘法公式的一般形式为\begin{equation}
P(A_1 A_2 \dotsm A_n)
= P(A_1) P(A_2 \vert A_1) P(A_3 \vert A_1 A_2) \dotsm P(A_n \vert A_1 A_2 \dotsm A_{n-1}).
\end{equation}
\end{theorem}

\begin{example}
一个小组有10名同学，其中4名女同学.每周依次有一名同学收作业.求第一、二周是女同学，第三、四周是男同学收作业的概率.
\begin{solution}
设\(A_i = \Set{ \text{第}\ i\ \text{周由女同学收作业} }\ (i=1,2,3,4)\)，则有\begin{align*}
P(A_1 A_2 \overline{A}_3 \overline{A}_4)
&= P(A_1) P(A_2 \vert A_1) P(\overline{A}_3 \vert A_1 A_2) P(\overline{A}_4 \vert A_1 A_2 \overline{A}_3) \\
&= \frac{4}{10} \times \frac{3}{9} \times \frac{6}{8} \times \frac{5}{7} = \frac{1}{14}.
\end{align*}
\end{solution}
\end{example}

\subsection{全概率公式与贝叶斯公式}
\begin{theorem}
设\(A_1,A_2,\dotsc,A_n\)为样本空间\(\Omega\)的一个完备事件组，且\[
P(A_i) > 0 \quad(i=1,2,\dotsc,n).
\]设\(B\)是任一事件，则：
\begin{enumerate}
\item \textbf{全概率公式}：\begin{equation}
P(B) = \sum\limits_{i=1}^n P(A_i) P(B \vert A_i);
\end{equation}
\item \textbf{贝叶斯公式}：若\(P(B) > 0\)，还有\begin{equation}
P(A_i \vert B) = \frac{P(A_i) P(B \vert A_i)}{P(B)}
= \frac{P(A_i) P(B \vert A_i)}{\sum\limits_{j=1}^n P(A_j) P(B \vert A_j)},
\quad i = 1,2,\dotsc,n.
\end{equation}
\end{enumerate}
\begin{proof}
全概率公式和贝叶斯公式的成立是显然的.因为\(B = B \Omega = B(A_1 \cup A_2 \cup \dotsb \cup A_n) = A_1 B \cup A_2 B \cup \dotsb A_n B\)，所以\[
P(B) = P\left(\bigcup\limits_{i=1}^n A_i B\right)
= \sum\limits_{i=1}^n P(A_i B)
= \sum\limits_{i=1}^n P(A_i) P(B \vert A_i).
\]

又因为\(P(A_i \vert B) = \frac{P(A_i B)}{P(B)}\)，而\(P(B \vert A_i) = \frac{P(A_i B)}{P(A_i)}\)，所以\[
P(A_i \vert B) = \frac{P(A_i) P(B \vert A_i)}{P(B)}.
\qedhere
\]
\end{proof}
\end{theorem}

构成完备事件组的每个事件\(A_i\)的发生，都有可能引起事件\(B\)的发生，%
故可视\(A_i\)为引起事件\(B\)发生的“原因事件”，\(B\)视为“结果事件”.
只要知道各“原因事件”发生的概率，且知道“原因事件”\(A_i\)发生后引起“结果事件”\(B\)发生的条件概率，%
则可求出\(B\)发生的概率.

如果我们\(P(A_i)\)称为\(A_i\)的\textbf{先验概率}，\(P(A_i \vert B)\)称为\(A_i\)的\textbf{后验概率}.
这就是当我们已知“结果事件”\(B\)发生后，追究是由哪一个“原因事件”引发的概率，从而由后验概率做出贝叶斯决策.

在应用全概率公式与贝叶斯公式时，选择完备事件组较为常见的情形有两种：
\begin{enumerate}
\item 将某过程的第一个步骤的所有情况作为完备事件组；
\item 将某先决事件\(A\)与\(\overline{A}\)作为完备事件组.
\end{enumerate}

\begin{example}
一盒中装有12个球，其中8个是新球.第一次比赛从盒中任取2个球，使用后放入盒中.第二次比赛时，再从盒中任取两球，求\begin{enumerate}
\item 第二次取出2个新球的概率；
\item 已知第二次取出2个新球，而第一次仅取出一个新球的概率.
\end{enumerate}
\begin{solution}
设\(B\)表示“第二次取出2个新球”，\(A_i\)表示“第一次取出2个球中有\(i\)个新球”，\(i=0,1,2\)，则\(A_0,A_1,A_2\)是第一次取球的完备事件组，且\[
P(A_0) = \frac{C_4^2}{C_{12}^2} = \frac{1}{11},
\quad
P(A_1) = \frac{C_4^1 C_8^1}{C_{12}^2} = \frac{16}{33},
\quad
P(A_2) = \frac{C_8^2}{C_{12}^2} = \frac{14}{33},
\]\[
P(B \vert A_0) = \frac{C_8^2}{C_{12}^2} = \frac{14}{33},
\quad
P(B \vert A_1) = \frac{C_7^2}{C_{12}^2} = \frac{7}{22},
\quad
P(B \vert A_2) = \frac{C_6^2}{C_{12}^2} = \frac{5}{22}.
\]

由全概率公式，有\begin{align*}
P(B) &= P(A_0) P(B \vert A_0)
	+ P(A_1) P(B \vert A_1)
	+ P(A_2) P(B \vert A_2) \\
&= \frac{1}{11} \times \frac{14}{33}
	+ \frac{16}{33} \times \frac{7}{22}
	+ \frac{14}{33} \times \frac{5}{22}
= 0.289\ 3.
\end{align*}

由贝叶斯公式，有\[
P(A_1 \vert B) = \frac{P(A_1) P(B \vert A_1)}{P(B)}
= \frac{\frac{16}{33} \times \frac{7}{22}}{0.289\ 3} = 0.533\ 3.
\]
\end{solution}
\end{example}

\section{事件的独立性及伯努利概型}
\subsection{事件的独立性}
从上一节可以发现，一般有\(P(A \vert B) \neq P(A)\)，即事件\(B\)发生后会影响事件\(A\)发生的概率，但也有例外的情形.

例如一袋中有3个白球7个红球，有放回地取两次球，每次一球.\(A_i\)表示“第\(i\)次取红球”，\(i=1,2\).此时显然有\(P(A_2) = P(A_2 \vert A_1) = \frac{7}{10}\).这表明\(A_1\)是否发生不影响\(A_2\)的发生.

一般地，如果\(P(B) > 0\)，且\(P(A \vert B) = P(A)\)时，则事件\(B\)的发生不影响事件\(A\)的发生.若还有\(P(A) > 0\)，则必有\(P(B \vert A) = P(B)\).这是因为\(P(A \vert B) = \frac{P(AB)}{P(B)} = P(A)\)，则有\(P(AB) = P(A) P(B)\)，从而\(P(B \vert A) = \frac{P(AB)}{P(A)} = P(B)\).

可见事件彼此间的影响是相互的.事件\(A\)与\(B\)的某一个发生不影响另一个发火说呢过的情形称为事件\(A\)与\(B\)相互独立，这等价于\(P(AB) = P(A) P(B)\).于是我们定义：

\begin{definition}
对同一试验的任意两事件\(A\)、\(B\)，若\[
P(AB) = P(A) P(B),
\]称“事件\(A\)与\(B\)\textbf{相互独立}”.
\end{definition}

注意，“\(A\)与\(B\)相互独立”和“\(A\)与\(B\)互斥”是两个不同的概念.事实上，只要\(P(A) > 0\)，\(P(B) > 0\)，“\(A\)与\(B\)相互独立”和“\(A\)与\(B\)互斥”这两种情况绝不会同时出现.这是因为当“\(A\)与\(B\)相互独立”时，\(P(AB) = P(A) P(B) > 0\)，这就与“\(A\)与\(B\)互斥”时\(AB = \emptyset\)，\(P(AB) = 0\)相矛盾.

设试验的样本空间为\(\Omega\)，显然\(P(\Omega) = 1, P(\emptyset) = 0\).
因为对于任意事件\(A\)，\(A \Omega = A\)，\(A \emptyset = \emptyset\)，那么\[
P(A \Omega) = P(A) = P(A) P(\Omega), \qquad
P(A \emptyset) = P(\emptyset) = P(A) P(\emptyset),
\]所以\(A\)与\(\Omega\)、\(A\)与\(\emptyset\)都相互独立.

\begin{theorem}
若事件\(A\)与\(B\)相互独立，则\(A\)与\(\overline{B}\)，\(\overline{A}\)与\(B\)，\(\overline{A}\)与\(\overline{B}\)也相互独立.
\begin{proof}
因为\(A\overline{B}=A(\Omega-B)=A-AB\)，\(P(AB)=P(A)P(B)\)，所以\[
P(A\overline{B})
= P(A) - P(AB)
= P(A) - P(A) P(B)
= P(A) [1 - P(B)]
= P(A) P(\overline{B}),
\]从而\(A\)与\(\overline{B}\)相互独立.
根据对称性易证\(\overline{A}\)与\(B\)，\(\overline{A}\)与\(\overline{B}\)也都相互独立.
\end{proof}
\end{theorem}

相互独立的概念可推广到多个事件的情形.
\begin{definition}
设\(A_1,A_2,\dotsc,A_n\ (n \geqslant 2)\)是\(n\)个事件，%
若任取两事件\(A_i,A_j\ (i \neq j)\)，有\[
P(A_i A_j) = P(A_i) P(A_j),
\]则称“这\(n\)个事件\textbf{两两独立}”.
\end{definition}

\begin{definition}
设\(A_1,A_2,\dotsc,A_n\)（\(n \geqslant 2\)）是\(n\)个事件，%
若对其中任意\(k\)（\(2 \leqslant k \leqslant n\)）个事件\(A_{i_1},A_{i_2},\dotsc,A_{i_k}\)有\[
P(A_{i_1} A_{i_2} \dotsm A_{i_k})
= P(A_{i_1}) P(A_{i_2}) \dotsm P(A_{i_k}),
\]则称“这\(n\)个事件\textbf{相互独立}”.
\end{definition}

\begin{theorem}
如果\(n\)个事件相互独立，则必有这\(n\)个事件两两独立；反之不然.
\end{theorem}

由定义判断\(n\)个事件的相互独立性，需要验证\(C_n^2+C_n^3+\dotsb+C_n^n=2^n-n-1\)个等式.
因此，在应用中，通常由实际意义判断事件的相互独立性.

概率论中，通常把概率小于0.05的事件叫做\textbf{小概率事件}.
小概率事件有两个特点：
第一，小概率事件在一次试验中几乎不可能发生；
第二，小概率事件在大量重复试验中几乎必定会至少发生一次.

\begin{example}
设\(0<P(B)<1\).
证明：\(A\)与\(B\)相互独立的充要条件为\(P(A \vert B) = P(A \vert \overline{B})\).
\begin{proof}
必要性.
当\(A\)与\(B\)独立时，有\(P(A \vert B) = P(A)\).
而此时，\(A\)与\(\overline{B}\)也独立，有\(P(A \vert \overline{B}) = P(A)\).
因此\(P(A \vert B) = P(A \vert \overline{B})\).

充分性.
若\(P(A \vert B) = P(A \vert \overline{B})\)，有\[
\frac{P(AB)}{P(B)}
= \frac{P(A\overline{B})}{P(\overline{B})}
= \frac{P(A)-P(AB)}{1-P(B)},
\]\[
P(AB) [1-P(B)] = P(B) [P(A)-P(AB)],
\]\[
P(AB) = P(A) P(B),
\]即\(A\)与\(B\)相互独立.
\end{proof}
\end{example}

\subsection{伯努利概型}
\begin{definition}
将随机试验重复进行\(n\)次，若各次试验的结果互不影响，即每次试验各可能结果出现的概率都不依赖其他各次试验的结果，这样的试验称为\(n\)重\textbf{独立试验}.

特别地，\(n\)重\textbf{独立试验}中，若每次试验结果只有两个，即\(A\)与\(\overline{A}\)，且\(0 < P(A) < 1\)，则这样的试验称为\(n\)重\textbf{伯努利试验}，相应的数学模型叫做\textbf{伯努利概型}.
\end{definition}

对于伯努利概型，我们需要计算\(A\)在\(n\)次试验中恰好发生\(k\)次的概率.

\begin{theorem}[二项概率]
在\(n\)重伯努利试验中，设\(A\)在各次试验中发生的概率为\(p = P(A)\ (0 < p < 1)\)，则在\(n\)次试验中\(A\)恰好发生\(k\)次的概率为\begin{equation}
P_n(k) = C_n^k p^k (1-p)^{n-k}, \quad k=0,1,\dotsc,n.
\end{equation}
\begin{proof}
设事件\(A_i\)表示“\(A\)在第\(i\)次试验发生”，则\(P(A_i)=p\)，\(P(\overline{A_i})=1-p\)，\(i=1,2,\dotsc,n\)，且各\(A_i\)相互独立.
由此可知，\(A\)在\(n\)次试验中某指定\(k\)次（如前\(k\)次）试验中发生而在其余\(n-k\)次试验中不发生的概率为\[
P(A_1 \dotsm A_k \overline{A_{k+1}} \dotsm \overline{A_n})
= P(A_1) \dotsm P(A_k) P(\overline{A_{k+1}}) \dotsm P(\overline{A_n})
= p^k (1-p)^{n-k}.
\]由于\(A\)在\(n\)次试验中恰好发生\(k\)次共有\(C_n^k\)种指定\(k\)次试验\(A\)发生的方式，且这\(C_n^k\)种指定的方式是两两互斥的，从而有概率的可加性，知\[
P_n(k) = C_n^k p^k (1-p)^{n-k},
\quad k=0,1,\dotsc,n.
\qedhere
\]
\end{proof}
\end{theorem}
由于\(P_n(k)\)正好是二项式\([p+(1-p)]^n\)展开式中的第\(k+1\)项，所以通常称\(P_n(k)\)为\DefineConcept{二项概率}.
同时也可看出，二项概率\(P_n(k)\)满足\begin{equation}
\sum\limits_{k=0}^n P_n(k)
= \sum\limits_{k=0}^n C_n^k p^k (1-p)^{n-k} = 1.
\end{equation}

在\(n\)重独立试验中，若每次试验有\(k\)个结果\(A_1,A_2,\dotsc,A_k\)，我们来求\(n\)次试验中\(A_i\)各发生\(r_i\)次概率.

\begin{theorem}[多项概率]
在\(n\)重独立试验中，每次试验可能的结果是\(A_1,A_2,\dotsc,A_k\)，且\(0 < p_i = P(A_i) < 1\ (i=1,2,\dotsc,k)\)，且\(p_1+p_2+\dotsb+p_k=1\)，则\(A_1,A_2,\dotsc,A_k\)在\(n\)次试验中各发生\(r_1,r_2,\dotsc,r_k\)次的概率为\begin{equation}\label{equation:概率论基础.多项概率公式}
\frac{n!}{r_1! r_2! \dotsm r_k!} p_1^{r_1} p_2^{r_2} \dotsm p_k^{r_k},
\end{equation}其中\(r_1+r_2+\dotsb+r_k=n\).
\end{theorem}
\cref{equation:概率论基础.多项概率公式} 叫做\textbf{多项概率公式}.
