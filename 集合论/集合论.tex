\chapter{集合论}
%@see: https://plato.stanford.edu/entries/set-theory/ZF.html

\section{类}
公理化集合论的一个目标是规避经典悖论，其中之一就是“罗素悖论”.
这个悖论来源于我们天真地接受了这样一个想法：
任给一个性质，总存在一个集合，它的元素都满足上述性质.
例如，给定一个合式公式\(\varphi\)，它只含一个自由变元，存在一个集合，
所有满足\(\varphi\)的对象都在这个集合里，
而所有不满足\(\varphi\)的对象都不在这个集合里，也就是说
\begin{equation}\label{equation:集合论.类的逻辑表示}
	(\forall x)[x \in a \iff \varphi(x)].
\end{equation}
这个原则被称为“抽象公理（Abstraction Axiom）”.
它曾在弗雷格于1893年所著的《算术基础（Grundgesetze der Arithmetik）》中出现过.
后来，罗素向弗雷格写信指出，抽象公理会导致悖论.

考虑到\(b \notin b\)是一个合式公式，
我们用受限变元\(x\)代替自由变元\(b\)，
代入到“抽象公理”中，作为\(\varphi(x)\).
然后，我们假设存在一个集合\(a\)使得\[
	(\forall x)[x \in a \iff x \notin x],
\]
那么，特别地，有\[
	a \in a \iff a \notin a.
\]
于是我们得到一个逻辑谬误，
这是因为根据排中律，要么有\(a \in a\)，要么有\(a \notin a\)，不能二者兼得.
这就说明“抽象公理”是一个假命题.

我们想要取得“满足某种特定性质的全部对象的汇集”的愿望难以摈弃，
而如若不拒绝“抽象公理”，则会导致悖论，我们又该怎么办呢？
策梅洛与弗伦克尔提供了以下解决方案：
我们把命题公式 \labelcref{equation:集合论.类的逻辑表示} 中的\(a\)称为%
“具有性质\(\varphi\)的各个事物的\DefineConcept{类}%
（the \emph{class} of individuals that have the property \(\varphi\)）”，
并且将它表示为
\begin{equation}
	\Set{ x \given \varphi(x) }.
\end{equation}
以后我们可以证明，类是对集合这一概念的延伸，
每个集合都是一个类，但不是每个类都是一个集合.
这里，其实我们也把用于表示元素与集合之间从属关系的\(\in\)符号的使用范围拓宽到类上了：
“一个对象是某个类\(\Set{ x \given \varphi(x) }\)的一个元素”%
当且仅当“这个对象是一个集合，且它具有这个类定义的性质\(\varphi\)”.
接下来，要解决罗素悖论，
我们只需证明\(\Set{ x \given x \notin x }\)%
是一个\DefineConcept{真类}（proper class），
也就是证明这个类不是集合.
正因为这个类不是集合，所以它不从属于任何一个类，包括它自己.

若要将形如\[
	\Set{ x \given \varphi(x) }
\]的符号加入我们的对象语言，
我们还需要扩大对合式公式的定义，
并增加公理，约束、管制这些新符号.
但是，我们不想这么做，
取而代之的是，
我们希望利用已然定义的概念来引入类.
于是我们有必要提供一套行之有效的流程，
用来将任意一条包含已定义概念的命题公式简化为基本符号.

\begin{definition}
我们可以归纳地给出\DefineConcept{广义合式公式}（well-formed formula in the wider sense）的定义：
\begin{enumerate}
	\item 如果\(a\)和\(b\)都是自由变元，那么\(a \in b\)是广义合式公式.
	\item 如果\(\varphi\)和\(\psi\)都是广义合式公式，且\(a\)和\(b\)都是自由变元，
	那么\[
		\def\A{\Set{ x \given \psi(x) }}
		\def\B{\Set{ x \given \varphi(x) }}
		a \in \A, \qquad
		\B \in b, \qquad
		\B \in \A
	\]都是广义合式公式.
	\item 如果\(\varphi\)和\(\psi\)都是广义合式公式，
	那么\[
		\neg\varphi, \qquad
		\varphi\land\psi, \qquad
		\varphi\lor\psi, \qquad
		\varphi\implies\psi,
		\varphi\iff\psi
	\]都是广义合式公式.
	\item 如果\(\varphi\)是广义合式公式，且\(x\)是受限变元，
	那么\[
		(\exists x)\varphi(x)
		\quad\text{和}\quad
		(\forall x)\varphi(x)
	\]都是广义合式公式.
\end{enumerate}
\end{definition}

\section{公理化集合论}
虽然直到19世纪末德国数学家康托才创立了集合论，
但是其实人们很早就开始使用集合的概念并对集合进行运算了.
在《周易·系辞下》中有这么一句话：“上古结绳而治，后世圣人易之以书契.”
于是我们想到，古人在农业生产中始终有着对农产品分类和计数的需要，
即将同类的产品集中地放置，
再用一个符记（例如手势、绳结、算筹、文字）表示这类产品的数量.

在本节我们先来介绍集合和元素的概念、集合存在公理，以及集合的运算法则.

\subsection{外延公理}
要实现对事物的分类，我们应该首先明白这样一点：
在现实世界中，事物之间的差异与矛盾是根本存在的.
我们知道，人对事物的认识，是人脑对客观现实的反映.
如果我们在观测事物时，观测手段十分粗略，
那么想必很难找出事物之间的差异；
如果我们在观测事物时，观测手段十分细致，
那么必然能够找出事物之间的更多差异.

为了解决上述问题，一组相对的哲学概念被提出来了，这就是“逻辑同一性”和“实在同一性”.
简单地说，实在同一性和逻辑同一性都是对事物关系的一种描述，
实在同一性要求被比较的事物无法被区分，
而逻辑同一性是指两个物在部分的属性上具备某种相同、相等或相似的关系.
以实在同一性和逻辑同一性作为分类的标准，
我们就可以区分事物以构建对立关系，又可以混同事物以构建等价关系.


\begin{axiom}[外延公理I]
%@see: 《Elements of Set Theory》 P17. Extensionality Axiom
如果集合\(A\)与集合\(B\)具有相同的元素，
则称“集合\(A\)与集合\(B\)\DefineConcept{相等}”，
记作\(A=B\)，即
\begin{equation}
	\forall A, \forall B \Bigl[
		\forall x \bigl( x \in A \iff x \in B \bigr)
		\implies
		A = B
	\Bigr].
\end{equation}
\end{axiom}
外延公理在英语中称作Extensionality Axiom，在德语中称作Axiom der Bestimmtheit.

我们也可把“集合相等”表述为
\begin{equation}
	(a=b)
	\defiff
	(\forall x)[x \in a \iff x \in b].
\end{equation}

\begin{property}
设\(a,b,c\)是集合.
那么有\begin{enumerate}
	\item\label{item:集合论.集合相等的自反性}
	自反性，即\(a=a\).
	\item\label{item:集合论.集合相等的对称性}
	对称性，即\(a=b \implies b=a\).
	\item\label{item:集合论.集合相等的传递性}
	传递性，即\(a=b \land b=c \implies a=c\).
\end{enumerate}
\begin{proof}
证明如下：
\begin{enumerate}
	\item \((\forall x)[x \in a \iff x \in a]\).
	\item \((\forall x)[x \in a \iff x \in b] \implies (\forall x)[x \in b \iff x \in a]\).
	\item \((\forall x)[x \in a \iff x \in b] \land (\forall x)[x \in b \iff x \in c]
	\implies (\forall x)[x \in a \iff x \in c]\).
	\qedhere
\end{enumerate}
\end{proof}
\end{property}

我们对相等性的直观理解源于同一性.
对于相等性，我们期望的一个基本性质是“两个相等的事物可以用另外两个相等的事物互相替代”.
也就是说，如果\(a=b\)，那么对于任意事物，可以断言关于\(a\)的任何事情也可以断言关于\(b\)
特别地，如果某个合式公式对\(a\)成立，那么它也应对\(b\)成立，并且反之亦然，即\[
	(a=b)\implies[\varphi(a)\iff\varphi(b)],
\]
其中\(\varphi(a)\)和\(\varphi(b)\)是%
用受限变元\(a\)和\(b\)代替合式公式\(\varphi\)中的某个相同的自由变元而取得的.

\begin{axiom}[外延公理II]
%@see: 《Introduction to Axiomatic Set Theory》 P8. Extensionality Axiom
设\(A,B,C\)是集合，那么\[
	A=B \land A \in C \implies B \in C.
\]
\end{axiom}

\begin{property}
设\(A,B,C\)是集合，那么\[
	A=B \implies [A \in C \iff B \in C].
\]
\begin{proof}
根据外延公理II和\hyperref[item:集合论.集合相等的对称性]{集合相等的对称性}易得.
\end{proof}
\end{property}

\begin{theorem}
\(a=b \implies [\varphi(a)\iff\varphi(b)]\).
\end{theorem}

外延公理说明一个集合完全由它的元素确定.


\subsection{集合存在公理}
让我们想象这样的情景：
你是一个在原始部落中负责管理仓库的工人学徒.
今天，猎人们从森林里带回一些猎物，堆放在地面上，让你把它们先分好类再收进仓库.
今天是你上班的第一天，你不知道这些猎物是什么.
说要分类，你也只能一屁股坐在空地上，面朝这些码放在一起的猎物，一筹莫展.
正在此时，一位老人颤颤巍巍地走了过来，他正是你的师父.
你向他询问这些猎物应当如何分类.

“你应该首先了解这些猎物具有的特征，”
在望了一眼这堆猎物以后，你的师父说道，
“你看，和我们人类一样，这些猎物身上长着眼睛的部位也叫做头部.
在它们的头上也长有和我们的嘴巴一样用来进食的部位.
但是，你要注意，有的猎物的‘嘴’的形状与我们的嘴巴不同，它的‘嘴’是尖尖的，
我们把这类猎物的‘嘴’叫做‘喙’；
此外这类猎物也长着和我们的脚一样用来站立的部位，但它的‘脚’也是尖尖的，
我们把这类猎物的‘脚’叫做‘爪子’；
最后，我们把这类猎物叫做‘鸟’.”
他掏出水壶，喝上一口水以后，继续说：
“今天你就学习怎么把‘鸟’从这堆猎物中筛选出来，放在一起.
其余的猎物我让别人来收拾.”
紧接着，他缓缓蹲下，捡了一只长着尖喙尖爪的猎物，递给你，
“这就是‘鸟’，你照着这个样子分类吧！”
说完这句话，师父站起身来，去其他地方溜达了.

你伸出左手接住师父递给你的那只鸟，
再用空着的右手在猎物堆里扒拉，随意地拎出一只猎物.
你举起双臂，扭动翻转手腕、手肘，
仔细查看这两只猎物，比较它们的特征是否一致.
如果两者不同，右手上的猎物没有尖喙尖爪，
就把它放到身体右侧，和原本堆在地上的猎物隔开一段距离，
再用右手重新抓一只猎物进行下一轮比较；
如果两者相同，右手的猎物也有尖喙尖爪，
就把你左手提着的这只鸟放在身体左侧，也和原本堆在地上的猎物隔开一段距离，
再把右手抓着的鸟转移到左手上，
然后用右手重新抓一只猎物进行下一轮比较.

在过了一会儿后，你发现面前没有需要分类的猎物了，
于是你把左手拎着的那只鸟也放在身体左侧.
就这样，你把猎人们放在地上的那堆猎物分成了两小堆，左边这堆全是鸟.


我们经常会像上面这个故事一样，
把一些事物收集在一起，把这个整体叫做一个\DefineConcept{集合}（set），
简称为\DefineConcept{集}；
然后把组成集合的这些事物叫做这个集合的\DefineConcept{元素}（member，或element），
简称为\DefineConcept{元}.
例如，在上面的故事中，在你举起双臂时，
你双手上抓着的两只鸟组成了一个集合，每只鸟都是这个集合的元素.
又例如，在你把猎物分成两堆以后，这两堆猎物中的每一堆都可以看作一个集合.
为了方便讨论，我们用大写拉丁字母（如\(A,B,C,X,Y\)等）表示集合，
用小写拉丁字母（如\(a,b,c,x,y\)等）表示元素.
由此，我们可以给出一个集合的粗糙的定义.

我们可以看出，集合具有三种特性：
\begin{enumerate}
	\item {\bf 确定性}，
	即对于任意一个元素，
	要么它属于某个指定集合，
	要么它不属于该集合，
	二者必居其一.
	\begin{itemize}
		\item 如果“元素\(a\)是集合\(A\)的元素（\(a\) is a \emph{member} of \(A\)，
		\(a\) is an \emph{element} of \(A\)）”，
		或“\(a\)\DefineConcept{属于} \(A\)（\(a\) \emph{belongs to} \(A\)）”，
		记作\(a \in A\)\footnote{%
		用来表记“所属关系（membership）”的符号\(\in\)实际上是变形的小写希腊字母\(\varepsilon\)，%
		它是由皮亚诺于 1889 年提出的.}.

		\item 如果“\(b\)不是集合\(A\)的元素（\(b\) is not an element of \(A\)）”，%
		或“\(b\)\DefineConcept{不属于} \(A\)（\(b\) does not belong to \(A\)）”，%
		记作\(b \notin A\).
	\end{itemize}

	\item {\bf 互异性}，
	即同一个集合中的元素是互不相同的，
	或者说，在以列举法表记的集合中，
	如果表记同一个元素的符号出现了多次，
	那么可以直接去除多余的符号而对集合的描述没有任何影响，即\[
		\Set{ x, x, y } = \Set{ x, y }.
	\]

	\item {\bf 无序性}，
	即在以列举法表记的集合中，
	任意改变集合中元素的排列次序，
	它们仍然表示同一个集合，即\[
		\Set{ y, x } = \Set{ x, y }.
	\]
\end{enumerate}



另外，根据上面这个故事，我们还可以想到：
一方面，原本空地上没有任何我们关心的东西，至少在这里我们并不关心空气和尘土；
另一方面，对于任意两个东西，如果我们觉得这两个东西能分类在一起，就可以把它们分类在一起.
我们可以说空地是一个空着的集合，或者说“空集”.
我们还说两只鸟组成一对鸟，或者说“对集”.

从上述生活经验出发，我们认定“空集”“对集”和“并集”是一定存在的，
于是我们可以给出如下的三个公理.

\begin{axiom}[空集公理]\label{axiom:集合论.空集公理}
%@see: 《Elements of Set Theory》 P18. Empty Set Axiom
总存在这样一个集合\(A\)，没有任何元素属于它\footnote{%
我们也可以用命题公式\[
	\exists A, \forall x \bigl( x \in A \iff x \neq x \bigr)
\]表示“没有任何元素的集合”的存在性.
它主要利用了“\((x \neq x)\)一定是假命题”这一点.
}，即\[
	\exists A, \forall x \bigl( x \notin A \bigr).
\]
\end{axiom}

\begin{axiom}[对集公理]\label{axiom:集合论.对集公理}
%@see: 《Elements of Set Theory》 P18. Pairing Axiom
对于任意两个元素\(u\)和\(v\)，
总存在一个集合\(B\)，它的元素只有\(u\)和\(v\)，即\[
	\forall u, \forall v, \exists B, \forall x
	\bigl(
		x \in B \iff x = u \lor x = v
	\bigr).
\]
\end{axiom}

\begin{axiom}[并集公理I]
%@see: 《Elements of Set Theory》 P18. Union Axiom, Preliminary Form
对于任意两个集合\(a\)和\(b\)，
总存在一个集合\(B\)，它的元素要么属于\(a\)，要么属于\(b\)，即\[
	\forall a, \forall b, \exists B, \forall x
	\bigl(
		x \in B
		\iff
		x \in a \lor x \in b
	\bigr).
\]
\end{axiom}

\begin{axiom}[幂集公理]
	对于任意集合\(A\)，总存在一个集合\(B\)，\(B\)的全部元素恰好是集合\(A\)的全部子集，即\[
	\forall A, \exists B, \forall x \bigl[
		x \in B
		\iff
		x \subseteq A
		\iff
		A \supseteq x
		\iff
		\forall t \bigl( t \in x \implies t \in A \bigr)
	\bigr].
\]
\end{axiom}


空集公理在英语中称作Empty Set Axiom.
对集公理在英语中称作Pairing Axiom.
并集公理在英语中称作Union Axiom, Preliminary Form，
在德语中称作Axiom der Vereinigung.
在德语中把对集公理和空集公理并称为Axiom der Elementarmengen.
幂集公理在英语中称作Power Set Axiom，在德语中称作Axiom der Potenzmenge.

下面我们给出我们对“空集”“对集”“并集”和“幂集”的正式定义.

\subsection{空集}
\begin{definition}
不含任何元素的集合称为\DefineConcept{空集}（empty set），
记作\(\emptyset\)，即
\begin{equation}
	\emptyset \defeq \Set{},
\end{equation}
或
\begin{equation}
	\emptyset \defeq \Set{ x \given x \neq x }.
\end{equation}
\end{definition}
%定义空集\(\emptyset\)时一定要注意两点：
%一是“空集”是否存在，这已由空集公理确保；
%二是“空集”是否唯一，这则由外延公理确保.
%若是没有这两条公理的帮助，我们就不能说\(\emptyset\)是良定义的.

容易看出，当我们说“集合\(A\)不是空集”或“集合\(A\)是非空集合”时，
\(A\)中必定至少有一个元素，即\[
	(\exists x)[x \in A].
\]

\subsection{对集}
\begin{definition}
对于任意给定的元素\(u\)和\(v\)，
我们用符号\[
	\Set{ u, v }
\]表示只有\(u,v\)元素的集合，
并把这个集合称为“\(u\)和\(v\)的\DefineConcept{对集}（pair set）”，即\[
	\Set{ u, v } \defeq \Set{ x \given x = u \lor x = v }.
\]
\end{definition}
在对集的定义中，我们没有明确说明元素\(u,v\)是否相同.
实际上，当\(u=v\)时，\(u\)和\(v\)的对集成为只含一个元素的集合\[
	\Set{ u } = \Set{ u, v };
\]
我们称这种集合为\DefineConcept{单元素集}（singleton）.
%@see: https://mathworld.wolfram.com/SingletonSet.html
单元素集是最简单的非空集合.

相对地，当\(u \neq v\)时，
我们把\(u\)和\(v\)的对集\(\Set{u,v}\)称为\DefineConcept{双元素集}.

利用对集公理和并集公理，我们可以构造任意有限集合.
例如，给定任意的\(x\)，我们可以定义“单元集”如下：\[
\{x\} \defeq \{x, x\}.
\]
又例如，给定任意的\(\v{x}{3}\)，我们可以定义由这三个元素构成的集合
\[
	\{\v{x}{3}\} \defeq \{x_1,x_2\}\cup\{x_3\};
\]
同样地，我们还可以定义\(\{\v{x}{4}\}\)，以此类推.

%可以看出，对集公理和并集公理是保障我们采用“列举法”表示集合这一方法论的正当性的基础.

\subsection{并集}
\begin{definition}
称\[
	\Set{ x \given x \in A \lor x \in B }
\]为“\(A\)和\(B\)的\DefineConcept{并}（the \emph{union} of \(A\) and \(B\)）”，
记作\(A \cup B\)或\(A+B\)，即\[
	A \cup B \defeq \Set{ x \given x \in A \lor x \in B }.
\]
\end{definition}


\begin{definition}
设系\(A = \Set{\v{a}{n}}\).
称集合\(\v{a}{n}\)的并\[
	a_1 \cup a_2 \cup \dotsb \cup a_n
\]为“\(A\)的\DefineConcept{并}”，
记作\(\bigcup A\)或\(\bigcup\limits_i a_i\)，即\[
	\bigcup A
	\defeq
	a_1 \cup a_2 \cup \dotsb \cup a_n
	= \Set*{ x \given \exists a \in A \bigl( x \in a \bigr) }.
\]
\end{definition}


为了确保“系的并”这样的集合存在，我们需要改进并集公理，如下：
\begin{axiom}[并集公理II]
对于任意集合\(A\)，总存在一个集合\(B\)，
使得集合\(B\)中的元素恰好是集合\(A\)中的元素的元素，即\[
	\forall x \Bigl[
		x \in B
		\iff
		\exists b \in A \bigl( x \in b \bigr)
	\Bigr].
\]
\end{axiom}

我们可以将\(\bigcup A\)的定义表述为如下形式：\[
	x \in \bigcup A
	\iff
	\exists b \in A \bigl( x \in b \bigr).
\]
原有的对于“集的并”的定义可以修改为\[
	a \cup b \defeq \bigcup\Set{a,b}.
\]

\begin{example}
%@see: 《Elements of Set Theory》 P26. Example
如果\(b \in A\)，那么必有\(b \subseteq \bigcup A\)，
这是因为对于\(\forall x, \forall b\)，总有\[
	x \in b \in A
	\implies
	x \in \bigcup A;
\]
反之则不然，例如\[
	A = \Set{\Set{1,2,3},\Set{1,4}}
	\implies
	\bigcup A = \Set{1,2,3,4},
\]
容易看出\(b = \Set{2,3,4} \subseteq \bigcup A\)，但是\(b \notin A\).
\end{example}

\begin{example}\label{example:集合论.有序对各坐标的取值范围}
%@see: 《Elements of Set Theory》 P26. Example
%@see: 《Elements of Set Theory》 P38. Lemma 3D
如果有\(\Set{ \Set{x}, \Set{x,y} } \in A\)，
考虑到\(\Set{x,y} \in \Set{ \Set{x}, \Set{x,y} }\)，
那么有\[
	\Set{x,y} \in \bigcup A;
\]
再考虑到\(x,y \in \Set{x,y}\)，
进而有\[
	x,y \in \bigcup\bigcup A.
\]
综上所述，我们有
\begin{equation}
	\Set{ \Set{x}, \Set{x,y} } \in A
	\implies
	x,y \in \bigcup\bigcup A.
\end{equation}
\end{example}

例如，
\begin{align*}
	&\bigcup\Set{a,b,c,d} = a \cup b \cup c \cup d. \\
	&\bigcup\Set{a} = a. \\
	&\bigcup\emptyset = \emptyset.
\end{align*}


\subsection{幂集}
\begin{definition}
由集合\(A\)的所有子集（包括空集和集合\(A\)本身）构成的集合，
称作“集合\(A\)的\DefineConcept{幂集}（power set）”，
记作\(\Powerset A\)或\(2^A\)或\(\mathcal{P}A\)，
即\[
	\Powerset A
	\defeq
	\Set{ x \given x \subseteq A }.
\]
\end{definition}

\begin{example}
%@see: 《Elements of Set Theory》 P26. Exercise 6(a).
证明：对任意集合\(A\)，总有
\begin{equation}\label{equation:集合论.集的幂集的并等于集}
	\bigcup \Powerset A = A.
\end{equation}
\begin{proof}
不难得到
\begin{align*}
	x \in \bigcup \Powerset A
	&\iff
	\exists b \in \Powerset A \bigl( x \in b \bigr) \\
	&\iff
	\exists b \subseteq A \bigl( x \in b \bigr) \\
	&\iff
	x \in A.
	\qedhere
\end{align*}
\end{proof}
\end{example}

\subsection{子集公理}
\begin{axiom}[子集公理]
%@see: 《Elements of Set Theory》 P21. Subset Axiom
对于不涉及\(B\)的每一条命题公式\(\lambda\)，命题\[
	\forall A, \exists B, \forall x \bigl(
		x \in B \iff x \in A \land \lambda
	\bigr)
\]是一条公理.
\end{axiom}
子集公理有时候也称作\DefineConcept{分离公理}，%
它在英语中称作Subset Axioms，%
在德语中称作Axiom der Aussonderung.
正如其名，该定理的作用就是从集合\(A\)中取出适合命题公式\(\lambda\)的元素，组合成新的集合\(B\).

可以看出，子集公理是保障我们采用“描述法”表示集合这一方法论的正当性的基础.
也就是说，\[
\Bigl[
	\forall A, \exists B, \forall x \bigl(
		x \in B \iff x \in A \land \lambda
	\bigr)
\Bigr]
\quad\iff\quad
B = \Set{ x \in A \given \lambda }.
\]

\begin{example}
以空集为元素构成的集合\(\Set{\emptyset}\)不是空集，即\(\Set{\emptyset} \neq \emptyset\).
这是因为\(\emptyset \in \Set{\emptyset}\)但\(\emptyset \notin \emptyset\).
\end{example}

现在我们可以利用子集公理和罗素悖论的论据来证明%
“包括所有集合的类\(V\)本身不是一个集合”.
\begin{theorem}\label{theorem:集合论.以所有集合为元素组成的集合不存在}
%@see: 《Elements of Set Theory》 P22. Theorem 2A
以所有集合为元素组成的集合不存在.
\begin{proof}
设\(A\)是一个集合.
令\[
B = \Set{ x \in A \given x \notin x }.
\]那么有\[
B \in B
\iff
B \in A \land B \notin B.
\eqno(1)
\]

假设\(B \in A\)，那么(1)式化为\[
B \in B \iff B \notin B,
\]矛盾，故\(B \notin A\).

综上所述，我们总可构造出一个不属于\(A\)的集合\(B\)，因此不存在“以所有集合为元素组成的集合”.
\end{proof}
\end{theorem}
有的人可能会对是否存在以其本身为元素的集合抱有疑问，我们将在后面证明这是不可能的.
而根据这个结论，在上面的证明中，集合\(B\)实际上与集合\(A\)完全相同.

利用子集定理，我们可以进一步定义子集、真子集、交集等概念.
\begin{definition}
设\(A\)、\(B\)是两个集合，
如果集合\(A\)的元素都是集合\(B\)的元素，
则称“\(A\)是\(B\)的\DefineConcept{子集}（\(A\) is a \emph{subset} of \(B\)）”，
记作\(A \subseteq B\)\footnote{读作“\(A\)包含于\(B\)（\(A\) is included in \(B\)）”.}，
或记作\(B \supseteq A\)\footnote{读作“\(B\)包含\(A\)（\(B\) includes \(A\)）”.}，
即\[
	\forall x \in A \bigl( x \in B \bigr)
	\iff A \subseteq B
	\iff B \supseteq A.
\]

若集合\(A \subseteq B\)且\(A \neq B\)，
则称“\(A\)是\(B\)的\DefineConcept{真子集}%
（\(A\) is a \emph{proper subset} of \(B\)）”，
记作\(A \subsetneqq B\)或\(B \supsetneqq A\)，即\[
	A \subseteq B
	\land
	A \neq B
	\iff
	A \subsetneqq B
	\iff
	B \supsetneqq A.
\]
\end{definition}

\begin{theorem}
任意集合都是其本身的子集，即\[
	\forall A \bigl( A \subseteq A \bigr).
\]
\end{theorem}

\begin{theorem}
空集\(\emptyset\)是任何集合的子集，即\[
	\forall A \bigl( \emptyset \subseteq A \bigr);
\]还是任何非空集合的真子集，即\[
	\forall A \bigl( A \neq \emptyset \iff \emptyset \subsetneqq A \bigr).
\]
\end{theorem}

在学习了从属关系（\(\in\)）和包含关系（\(\subseteq\)）以后，切莫将两者搞混.
在讨论\(A \in B\)是否成立时，我们是将\(A\)作为一个整体，看它是不是\(B\)中的一个元素.
在讨论\(A \subseteq B\)是否成立时，我们要将\(A\)打开，检查它里面的所有元素是不是都是\(B\)中的元素.

\begin{theorem}
如果集合\(A\)与集合\(B\)互为子集，那么集合\(A\)与集合\(B\)相等，即\[
	A \subseteq B \land B \subseteq A
	\iff
	A = B.
\]
\end{theorem}

\begin{example}
\(\Powerset \emptyset = \{ \emptyset \},%
\Powerset \Set{ \emptyset } = \{ \emptyset, \{ \emptyset \} \}\).
\end{example}

\begin{example}
对于任意集合\(A,B\)，试分析\(\Powerset(A-B)\)与\(\Powerset A - \Powerset B\)是否相等.
\begin{solution}
集合\(\Powerset(A-B)\)包含集合\(A-B\)的所有子集，
那么总有\(\emptyset\in\Powerset(A-B)\).
但是\(\emptyset\notin\Powerset A - \Powerset B\)，
所以\(\Powerset(A-B) \neq \Powerset A - \Powerset B\).
\end{solution}
\end{example}

\begin{example}
求非空集合\(S\)的所有单元素子集.
\begin{solution}
我们知道\(\Powerset S\)中的元素是\(S\)的全部子集，
于是我们可以利用子集公理从中找出只有一个元素的集合，将它们重组为一个新的集合\[
	\Set{ a \in \Powerset S \given \text{\(a\)是单元集} }.
\]
我们知道，单元素集中有且仅有一个元素，由此可知\[
	a \neq \emptyset
	\land
	\forall u,v \in a \bigl( u = v \bigr).
\]
综上所述，非空集合\(S\)的所有单元素子集的集合为\[
	\Set*{ a \in \Powerset S \given a \neq \emptyset
	\land
	\forall u,v \in a \bigl( u = v \bigr) }.
\]
\end{solution}
\end{example}


\subsection{交集}

\begin{definition}
称\[
	\Set{ x \given x \in A \land x \in B }
\]为“\(A\)和\(B\)的\DefineConcept{交}（the \emph{intersection} of \(A\) and \(B\)）”，
记作\(A \cap B\)或\(AB\).
\end{definition}

\begin{theorem}\label{theorem:集合论.系的交的唯一存在性}
%@see: 《Elements of Set Theory》 P25. Theorem 2B
对于任意非空集合\(A\)，存在唯一的集合\(B\)，使得\[
	(\forall x)[x \in B \iff (\forall a)[a \in A \implies x \in a]].
\]
\begin{proof}
先证集合\(B\)的存在性.
既然\(A\)是非空集，不妨取定\(c \in A\).
那么根据子集公理，存在集合\(B\)，使得对于任意\(x\)，都有\[
	x \in B
	\iff
	x \in c \land (\forall a)[a \in A \implies x \in a];
\]
由于\(c\)是从\(A\)中任意取出的一个元素，所以\[
	(\forall a)[a \in A \implies x \in a]
	\implies
	x \in c,
\]
那么就有\[
	x \in B
	\iff
	(\forall a)[a \in A \implies x \in a].
\]

根据外延公理不难得出集合\(B\)的唯一性.
\end{proof}
\end{theorem}

\begin{example}
%@see: 《Elements of Set Theory》 P26. Example
因为\[
	\bigcap\Set{\Set{a},\Set{a,b}}
	= \Set{a}\cap\Set{a,b}
	= \Set{a},
\]
所以\[
	\bigcup\bigcap\Set{\Set{a},\Set{a,b}}
	= \bigcup\Set{a}
	= a.
\]

类似有\[
	\bigcap\bigcup\Set{\Set{a},\Set{a,b}}
	= \bigcap\Set{a,b}
	= a \cap b.
\]
\end{example}

\begin{definition}
设系\(A = \Set{\v{a}{n}}\).
称集合\(\v{a}{n}\)的交\[
	a_1 \cap a_2 \cap \dotsb \cap a_n
\]为\(A\)的\DefineConcept{交}\footnote{%
\cref{theorem:集合论.系的交的唯一存在性} 确保了\(\bigcap A\)可以定义为唯一存在的集合\(B\).
}，%
记作\(\bigcap A\)或\(\bigcap\limits_i a_i\)，即\[
	\bigcap A
	\defeq
	a_1 \cap a_2 \cap \dotsb \cap a_n
	= \Set*{ x \given \forall a \in A \bigl(x \in a\bigr) }.
\]
\end{definition}

例如，
\begin{align*}
	&\bigcap\Set{a} = a. \\
	&\bigcap\Set{a,b} = a \cap b. \\
	&\bigcap\Set{a,b,c,d} = a \cap b \cap c \cap d.
\end{align*}

特别注意到“\(\bigcap\emptyset\)”是未定义的！

\begin{example}
因为\(\bigcap\Set{ \Set{a}, \Set{a,b} } = \Set{a} \cap \Set{a,b} = \Set{a}\)，%
所以\[
\bigcup \bigcap \Set{ \Set{a}, \Set{a,b} } = \bigcup \Set{a} = a;
\]\[
\bigcap \bigcup \Set{ \Set{a}, \Set{a,b} } = \bigcap \Set{a,b} = a \cap b.
\]
\end{example}

\subsection{差集}
\begin{definition}
称集合\[
	\Set{ x \given x \in A \land x \notin B }
\]为“\(A\)和\(B\)的\DefineConcept{差集}%
（the \emph{relative complement} of \(B\) in \(A\)）”，
记作\(A - B\)或\(A \setminus B\).
\end{definition}

\begin{definition}[全集、补集]
有时，我们研究某个问题限定在一个大的集合\(U\)中进行，所研究的其他集合都是\(U\)的子集；
此时我们称集合\(U\)为\DefineConcept{全集}（universe）或\DefineConcept{基本集}.

设集合\(A \subseteq U\)，
则称\(U-A\)为“\(A\)的\DefineConcept{补集}或\DefineConcept{余集}”，
记作\(\overline{A}\)，或\(\complement_U A\)，或\(A^C\).
\end{definition}

\begin{example}
%@see: 《Elements of Set Theory》 P26. Exercise 6(b).
证明：对任意集合\(A\)，总有
\begin{equation}\label{equation:集合论.系的并的幂集包含系}
	A \subseteq \Powerset \bigcup A;
\end{equation}
并找出使得\(A = \Powerset \bigcup A\)成立的条件.
\begin{proof}
因为对于\(\forall a\)，总有\[
	a \in A
	\implies
	a \subseteq \bigcup A
	\iff
	a \in \Powerset \bigcup A,
\]
所以\[
	A \subseteq \Powerset \bigcup A.
\]

从上面的证明过程可以看出，
当\[
	\forall a \bigl( a \subseteq \bigcup A \iff a \in A \bigr)
\]时，就有\(A = \Powerset \bigcup A\)成立.

在\(a \subseteq \bigcup A \implies a \in A\)的前提下，
由于总有\(\emptyset \subseteq \bigcup A\)成立，
所以\(\emptyset \in A\)恒成立.
考虑当\(A = \Set{\emptyset}\)成立时，
必有\(\bigcup A = \bigcup\Set{\emptyset} = \emptyset\)，
因此\(\Powerset \bigcup A = \Powerset \emptyset = \Set{\emptyset} = A\).
%TODO
\end{proof}
\end{example}


\section{集合代数}

\begin{figure}[ht]
	\def\subwidth{.5\linewidth}
	\centering
	\begin{subfigure}[b]{\subwidth}
		\centering
		\begin{tikzpicture}
			\path[save path=\pathA](-1,0)circle(2cm);
			\path[save path=\pathB](+1,0)circle(2cm);
			\begin{scope}
				\clip[use path=\pathA];
				\fill[black!30][use path=\pathB];
			\end{scope}
			\draw[use path=\pathA];
			\draw[use path=\pathB];
			\draw(0,0)node{\(A \cap B\)};
		\end{tikzpicture}
		\subcaption{集合的交}
	\end{subfigure}%
	\begin{subfigure}[b]{\subwidth}
		\centering
		\begin{tikzpicture}
			\path[save path=\pathA,name path=A](-1,0)circle(2cm);
			\path[save path=\pathB,name path=B](+1,0)circle(2cm);
			\path[fill=black!30][use path=\pathA+\pathB];
			\draw[name intersections={of=A and B}]
				(intersection-1)arc[start angle=60,end angle=300,radius=2]
				(intersection-2)arc[start angle=-120,end angle=120,radius=2]
				(intersection-1);
			\draw(0,0)node{\(A \cup B\)};
			\pgfresetboundingbox
			\path[use as bounding box] (-3,-2)rectangle(3,2);
		\end{tikzpicture}
		\subcaption{集合的并}
	\end{subfigure}%

	\begin{subfigure}[b]{\linewidth}
		\centering
		\begin{tikzpicture}
			\fill[black!30](0,{sqrt(3)})arc[start angle=60,end angle=300,radius=2]
				arc[start angle=240,end angle=120,radius=2];
			\draw(-1,0)circle(2cm);
			\draw(+1,0)circle(2cm);
			\draw(-2,0)node{\(A-B\)};
			\pgfresetboundingbox
			\path[use as bounding box] (-3,-2)rectangle(3,2);
		\end{tikzpicture}
		\subcaption{集合的差}
	\end{subfigure}%
	\caption{韦恩图}
	\label{figure:集合论.韦恩图}
\end{figure}

\begin{property}
集合的运算满足以下性质：
\begin{enumerate}
\item 交换律（{\rm Commutative laws}）
\begin{gather}
	A \cap B = B \cap A, \label{equation:集合论.集合代数公式1-1} \\
	A \cup B = B \cup A. \label{equation:集合论.集合代数公式1-2}
\end{gather}

\item 结合律（{\rm Associative laws}）
\begin{gather}
	(A \cap B) \cap C = A \cap (B \cap C), \label{equation:集合论.集合代数公式2-1} \\
	(A \cup B) \cup C = A \cup (B \cup C). \label{equation:集合论.集合代数公式2-2}
\end{gather}

\item 分配律（{\rm Distributive laws}）
\begin{gather}
	(A \cap B) \cup C = (A \cup C) \cap (B \cup C), \label{equation:集合论.集合代数公式3-1} \\
	(A \cup B) \cap C = (A \cap C) \cup (B \cap C), \label{equation:集合论.集合代数公式3-2} \\
	A \cup \bigcap \mathscr{B} = \bigcap\Set{A \cup X \given X \in \mathscr{B}}, \quad(\mathscr{B}\neq\emptyset) \label{equation:集合论.集合代数公式3-3} \\
	A \cap \bigcup \mathscr{B} = \bigcup\Set{A \cap X \given X \in \mathscr{B}}, \label{equation:集合论.集合代数公式3-4} \\
	\Powerset (A \cup B) \supseteq \Powerset A \cup \Powerset B, \label{equation:集合论.集合代数公式3-5} \\ %@see: 《Elements of Set Theory》 P26. Exercise 7(b).
	\Powerset (A \cap B) = \Powerset A \cap \Powerset B. \label{equation:集合论.集合代数公式3-6} %@see: 《Elements of Set Theory》 P26. Exercise 7(a)
\end{gather}

\item 对偶律（{\rm De Morgan's laws}）（假设\(\mathscr{A}\neq\emptyset\)）
\begin{gather}
	\overline{A \cap B} = \overline A \cup \overline B, \label{equation:集合论.集合代数公式4-1} \\
	\overline{A \cup B} = \overline A \cap \overline B, \label{equation:集合论.集合代数公式4-2} \\
	C - \bigcup\mathscr{A} = \bigcap\Set{C-X \given X\in\mathscr{A}}, \label{equation:集合论.集合代数公式4-3} \\
	C - \bigcap\mathscr{A} = \bigcup\Set{C-X \given X\in\mathscr{A}}. \label{equation:集合论.集合代数公式4-4}
\end{gather}

\item 与空集\(\emptyset\)和全集\(\Omega\)的运算（假设\(A \subseteq \Omega\)）
\begin{gather}
	A \cup \emptyset = A, \label{equation:集合论.集合代数公式5-1} \\
	A \cap \emptyset = \emptyset, \label{equation:集合论.集合代数公式5-2} \\
	A \cup \Omega = \Omega, \label{equation:集合论.集合代数公式5-3} \\
	A \cap \Omega = A, \label{equation:集合论.集合代数公式5-4} \\
	A \cup \overline{A} = \Omega, \label{equation:集合论.集合代数公式5-5} \\
	A \cap \overline{A} = \emptyset. \label{equation:集合论.集合代数公式5-6}
\end{gather}

\item 包含关系
\begin{gather}
	A \subseteq B \implies A \cup C \subseteq B \cup C, \label{equation:集合论.集合代数公式6-1} \\
	A \subseteq B \implies A \cap C \subseteq B \cap C, \label{equation:集合论.集合代数公式6-2} \\
	A \subseteq B \implies \bigcup A \subseteq \bigcup B, \label{equation:集合论.集合代数公式6-3} \\
	A \subseteq B \implies \overline{B} \subseteq \overline{A}, \label{equation:集合论.集合代数公式6-4} \\
	\emptyset \neq A \subseteq B \implies \bigcap B \subseteq \bigcap A. \label{equation:集合论.集合代数公式6-5}
\end{gather}
\end{enumerate}
\begin{proof}
对\cref{equation:集合论.集合代数公式1-1} 证明如下：
\begin{align*}
	x \in A \cap B
	&\iff x \in A \land x \in B \\
	&\iff x \in B \land x \in A \\
	&\iff x \in B \cap A.
\end{align*}

对\cref{equation:集合论.集合代数公式1-2} 证明如下：
\begin{align*}
	x \in A \cup B
	&\iff x \in A \lor x \in B \\
	&\iff x \in B \lor x \in A \\
	&\iff x \in B \cup A.
\end{align*}

对\cref{equation:集合论.集合代数公式2-1} 证明如下：
\begin{align*}
	x \in (A \cap B) \cap C
	&\iff x \in A \cap B \land x \in C \\
	&\iff (x \in A \land x \in B) \land x \in C \\
	&\iff x \in A \land (x \in B \land x \in C) \\
	&\iff x \in A \land x \in B \cap C \\
	&\iff x \in A \cap (B \cap C).
\end{align*}

对\cref{equation:集合论.集合代数公式2-2} 证明如下：
\begin{align*}
	x \in (A \cup B) \cup C
	&\iff x \in A \cup B \lor x \in C \\
	&\iff (x \in A \lor x \in B) \lor x \in C \\
	&\iff x \in A \lor (x \in B \lor x \in C) \\
	&\iff x \in A \lor x \in B \cup C \\
	&\iff x \in A \cup (B \cup C).
\end{align*}

对\cref{equation:集合论.集合代数公式3-5} 证明如下：
\begin{align*}
	x \in \Powerset A \cup \Powerset B
	&\iff x \in \Powerset A \lor x \in \Powerset B \\
	&\iff x \subseteq A \lor x \subseteq B \\
	&\implies x \subseteq A \cup B \\
	&\iff x \in \Powerset (A \cup B),
\end{align*}
注意到中间步骤的\(\implies\)通常不是可逆的，
这是因为只要取\(a \subseteq A - B, b \subseteq B - A, x = a \cup b\)，
就有\(x \subseteq A \cup B\)但是\(x \not\subseteq A \land x \not\subseteq B\)，
因此\(x \subseteq A \cup B \notimplies x \subseteq A \lor x \subseteq B\).
%从上面的证明过程可以看出，
%要使\(\Powerset (A \cup B) = \Powerset A \cup \Powerset B\)成立，
%必有\[
%	\forall x \bigl(
%		x \subseteq A \cup B
%		\iff
%		x \subseteq A \lor x \subseteq B
%	\bigr)
%\]成立.
%取\(x = A \cup B\)，
%由\(x \subseteq A \lor x \subseteq B\)
%可得\[
%	A \cup B = A \lor A \cup B = B.
%\]
%因此，当且仅当\(A \cup B \in \Set{A,B}\)时，
%就有\(\Powerset (A \cup B) = \Powerset A \cup \Powerset B\)成立.

对\cref{equation:集合论.集合代数公式3-6} 证明如下：
\begin{align*}
	x \in \Powerset (A \cap B)
	&\iff x \subseteq A \cap B \\
	&\iff x \subseteq A \land x \subseteq B \\
	&\iff x \in \Powerset A \land x \in \Powerset B \\
	&\iff x \in \Powerset A \cap \Powerset B.
\end{align*}

对\cref{equation:集合论.集合代数公式6-5} 证明如下：
\begin{align*}
	A \subseteq B
	&\iff (\forall t)[t \in A \implies t \in B] \\
	&\implies (\forall x)[
		(\forall b)[b \in B \implies x \in b]
		\implies
		(\forall a)[a \in A \implies x \in a]
	] \\
	&\iff (\forall x)[x \in \bigcap B \implies x \in \bigcap A].
	\qedhere
\end{align*}
\end{proof}
\end{property}

\begin{example}
%@see: 《Elements of Set Theory》 P32. Exercise 21.
设\(A,B\)是集合.
证明：\begin{equation}
	\bigcup(A \cup B) = \bigcup A \cup \bigcup B.
\end{equation}
%TODO
%\begin{proof}
%直接计算得
%\begin{align*}
%	t \in \bigcup(A \cup B)
%	&\iff \exists x \in A \cup B \bigl(
%		t \in x
%	\bigr) \\
%	&\iff \exists x \bigl(
%		x \in A \lor x \in B
%		\implies
%		t \in x
%	\bigr) \\
%	&\iff
%		\exists x \in A \bigl( t \in x \bigr)
%		\lor
%		\exists x \in B \bigl( t \in x \bigr) \\
%	&\iff t \in \bigcup A \lor t \in \bigcup B \\
%	&\iff t \in \bigcup A \cup \bigcup B.
%	\qedhere
%\end{align*}
%\end{proof}
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P32. Exercise 22.
设\(A,B\)是非空集合.
证明：\begin{equation}
	\bigcap(A \cup B) = \bigcap A \cap \bigcap B.
\end{equation}
%TODO
%\begin{proof}
%直接计算得\begin{align*}
%	t \in \bigcap(A \cup B)
%	&\iff
%	\forall x \in A \cup B \bigl(
%		t \in x
%	\bigr) \\
%	&\iff
%	\forall x \bigl(
%		x \in A \lor x \in B
%		\implies
%		t \in x
%	\bigr) \\
%	&\iff
%	\forall x \in A \bigl( t \in x \bigr)
%	\land
%	\forall x \in B \bigl( t \in x \bigr) \\
%	&\iff
%	t \in \bigcap A \land t \in \bigcap B \\
%	&\iff
%	t \in \bigcap A \cap \bigcap B.
%	\qedhere
%\end{align*}
%\end{proof}
\end{example}

\begin{example}
证明：\begin{equation}
	(A \cup B) - (A \cap B) = (A-B)\cup(B-A).
\end{equation}
\begin{proof}
根据集合交、并、差的定义，有
\begin{align*}
	x \in (A \cup B) - (A \cap B)
	&\iff x \in (A \cup B) \land x \notin (A \cap B) \\
	&\iff (x \in A \lor x \in B) \land \neg(x \in A \land x \in B) \\
	&\iff (x \in A \land \neg(x \in A \land x \in B))
	 \lor (x \in B \land \neg(x \in A \land x \in B)) \\
	&\iff (x \in A \land (x \notin A \lor x \notin B))
	 \lor (x \in B \land (x \notin A \lor x \notin B)) \\
	&\iff (x \in A \land x \notin B) \lor (x \in B \land x \notin A) \\
	&\iff x \in (A-B)\cup(B-A).
\qedhere
\end{align*}
\end{proof}
\end{example}

\section{关系}
\subsection{无序对、有序对的概念}
\begin{definition}[无序对]
由两个元素\(x_1\)和\(x_2\)组成的集合\[
\Set{x_1, x_2}
\]称作\DefineConcept{无序对}（unordered pair）.
\end{definition}

\begin{example}
%@see: 《Elements of Set Theory》 P38. Exercise 1.
定义：\[
\opair{x,y,z}^* = \{\{x\},\{x,y\},\{x,y,z\}\}.
\]找出元素\(u,v,w,x,y,z\)使\[
\opair{x,y,z}^* = \opair{u,v,w}^*
\]成立，但\(y \neq v\)或\(z \neq w\).
\begin{solution}
取\[
\opair{1,1,2}^* = \{\{1\},\{1,1\},\{1,1,2\}\} = \{\{1\},\{1,2\}\},
\]\[
\opair{1,2,1}^* = \{\{1\},\{1,2\},\{1,2,1\}\} = \{\{1\},\{1,2\}\},
\]即可满足题设条件.
\end{solution}
\end{example}

\begin{definition}[有序对]
两个元素\(x_1\)和\(x_2\)按一定顺序形成的排列称为\DefineConcept{有序对}，记作\[
\opair{x_1,x_2}.
\]

我们可以采用多种方式构造集合用于表记有序对\(\opair{x_1,x_2}\)，例如（由Norbert Wiener于1914年构造的）
\[
\Set{ \Set{ \Set{x_1}, \emptyset }, \Set{ \Set{ x_2 } } }.
\]
但我们更常用（由Kazimierz Kuratowski于1921年构造的）以下形式
\[
\Set{ \Set{x_1}, \Set{x_1, x_2} }.
\]以后我们都采用第二种形式表记有序对，因此\[
\opair{x_1,x_2}
\defeq
\Set{ \Set{x_1}, \Set{x_1, x_2} }.
\]
\end{definition}

有序对具有以下性质.
\begin{property}\label{theorem:集合论.有序对的性质1}
%@see: 《Elements of Set Theory》 P36. Theorem 3A
\(\opair{u,v} = \opair{x,y}\)的充要条件是：\(u=x\)且\(v=y\).
\begin{proof}
充分性.
这个方向的证明是平凡的；
当\(u=x\)且\(v=y\)时，自然有\[
	\opair{u,v} = \opair{x,y}.
\]

必要性.
当\(\opair{u,v} = \opair{x,y}\)时，根据定义有\[
	\Set{ \Set{u}, \Set{u, v} }
	= \Set{ \Set{x}, \Set{x, y} };
\]于是\[
	\Set{u} \in \Set{ \Set{x}, \Set{x, y} },
	\eqno{(1)}
\]且\[
	\Set{u,v} \in \Set{ \Set{x}, \Set{x, y} }.
	\eqno{(2)}
\]
从(1)式我们知道，要么等式\[
	\Set{u} = \Set{x}
	\eqno{(3)}
\]成立，要么等式\[
	\Set{u} = \Set{x,y}
	\eqno{(4)}
\]成立；
从(2)式我们知道，要么等式\[
	\Set{u,v} = \Set{x}
	\eqno{(5)}
\]成立，要么等式\[
	\Set{u,v} = \Set{x,y}
	\eqno{(6)}
\]成立.

首先我们假设(4)式成立，那么有\(u = x = y\)；
从而有(5)式等价于(6)式，且\(u = v = x = y\)；
在这种情况下，必要性得证.
同理，假设(5)式成立，也可证明必要性.

然后我们假设(3)式、(6)式同时成立.
从(3)式成立我们知道\(u = x\).
从(6)式成立我们知道\(u = y\)或\(v = y\)；
第一种情况，即\(u = x\)和\(u = y\)同时成立的情况，已经在(4)式成立时作了讨论.
第二种情况，即\(u = x\)和\(v = y\)同时成立的情况，立即保证了必要性.
\end{proof}
\end{property}
\cref{theorem:集合论.有序对的性质1} 让我们可以不含糊地将有序对\(\opair{x,y}\)
中的\(x\)和\(y\)分别称为%
有序对的\DefineConcept{第一坐标}（first coordinate）%
和\DefineConcept{第二坐标}（second coordinate）.

\subsection{直积}
\begin{definition}[直积]\label{definition:集合论.直积}
设\(A,B\)都是集合.
在\(A\)中任取一个元素\(x\)，
在\(B\)中任取一个元素\(y\)，
组成一个有序对\(\opair{x,y}\)，
把这样的有序对作为新的元素，
它们全体组成的集合称为“\(A\)与\(B\)的%
\DefineConcept{直积}或\DefineConcept{笛卡尔乘积}（Cartesian product）”，
记为\(A \times B\)，即\[
	A \times B
	\defeq
	\Set{ \opair{x,y} \given x \in A, y \in B }.
\]

特别地，集合\(A\)与自己的直积\(A \times A\)可以简记为\(A^2\)，
\((A \times A) \times A\)可以简记为\(A^3\)，以此类推.
\end{definition}

在宣称\cref{definition:集合论.直积} 合法以前，
我们必须确认它给出的收集\(A \times B\)是不是真的是一个集合.
设符号\(\lambda(t)\)表示“与\(t\)有关的命题公式”，
我们在运用描述法记号\[
	\Set{ t \given \lambda(t) }
\]表记一个集合时，必须验证是不是真的存在一个集合\(D\)，使得\[
	\forall t \bigl( t \in D \iff \lambda(t) \bigr)
\]成立.
例如，虽然\[
	\Set{ x \given x = x }
	\quad\text{和}\quad
	\Set{ x \given x \neq x }
\]这两个表达式看起来相似，
但根据\cref{theorem:集合论.以所有集合为元素组成的集合不存在}，
这里的第一个表达式不能表示一个集合；
然而根据空集公理，第二个表达式就可以表示空集.

要证明\(A \times B\)是一个集合，
我们就必须找到一个足够大的集合，
它包括了我们需要的全部有序对，
然后利用子集公理证明\(A \times B\)是这个集合的子集.
因此，我们给出下述引理.
\begin{lemma}\label{theorem:集合论.有序对是其坐标元素所在集合的二重幂集的元素}
%@see: 《Elements of Set Theory》 P37. Lemma 3B
如果\(x,y \in A\)，那么\[
	\opair{x,y} \in \Powerset\Powerset A.
\]
\begin{proof}
由\(x,y \in A\)可知\(\{x\},\{x,y\} \subseteq A\)，
即\(\{x\},\{x,y\} \in \Powerset A\)，
那么\(\{\{x\},\{x,y\}\} \subseteq \Powerset A\)，
进一步可得\(\{\{x\},\{x,y\}\} \in \Powerset\Powerset A\).
\end{proof}
\end{lemma}

\begin{theorem}\label{theorem:集合论.直积存在定理}
%@see: 《Elements of Set Theory》 P38. Corollary 3C
对任意集合\(A,B\)，存在这样一个集合，
它的元素全是有序对\(\opair{x,y}\)，
其中\(x \in A\)，\(y \in B\).
\begin{proof}
根据子集公理，我们可以构造集合\[
	\Set*{ w \in \Powerset\Powerset(A \cup B) \given w = \opair{x,y}, x \in A, y \in B }.
\]
显然，根据\cref{theorem:集合论.有序对是其坐标元素所在集合的二重幂集的元素}，
这个集合仅包括我们需要的有序对.
\end{proof}
\end{theorem}
依靠\cref{theorem:集合论.直积存在定理}，
我们就可以正当化先前对\hyperref[definition:集合论.直积]{直积}\(A \times B\)的定义.

容易发现，对于任意集合\(A\)，总有\begin{equation}
	A \times \emptyset
	= \emptyset \times A
	= \emptyset \times \emptyset
	= \emptyset.
\end{equation}

\begin{example}
%@see: 《Elements of Set Theory》 P38. Exercise 2.(a)
%@see: 《Elements of Set Theory》 P65. Exercise 54.
设\(A,B,C\)是集合.
证明：\begin{gather}
	A \times (B \cup C) = (A \times B) \cup (A \times C),
	\label{equation:集合论.直积分配律1} \\
	A \times (B \cap C) = (A \times B) \cap (A \times C),
	\label{equation:集合论.直积分配律2} \\
	A \times (B - C) = (A \times B) - (A \times C).
	\label{equation:集合论.直积分配律3}
\end{gather}
\begin{proof}
对\cref{equation:集合论.直积分配律1} 证明如下：
由于对于任意\(w = \opair{x,y}\)总有
\begin{align*}
	w \in A \times (B \cup C)
	&\iff x \in A \land y \in B \cup C \\
	&\iff x \in A \land (y \in B \lor y \in C) \\
	&\iff (x \in A \land y \in B) \lor (x \in A \land y \in C) \\
	&\iff (w \in A \times B) \lor (w \in A \times C),
\end{align*}
那么由外延公理可知\(A \times (B \cup C) = (A \times B) \cup (A \times C)\).

对\cref{equation:集合论.直积分配律2} 证明如下：
由于对于任意\(w = \opair{x,y}\)总有
\begin{align*}
	w \in A \times (B \cap C)
	&\iff x \in A \land y \in B \cap C \\
	&\iff x \in A \land (y \in B \land y \in C) \\
	&\iff (x \in A \land y \in B) \land (x \in A \land y \in C) \\
	&\iff (w \in A \times B) \land (w \in A \times C),
\end{align*}
那么由外延公理可知\(A \times (B \cap C) = (A \times B) \cap (A \times C)\).

对\cref{equation:集合论.直积分配律3} 证明如下：
由于对于任意\(w = \opair{x,y}\)总有
\begin{align*}
	w \in A \times (B - C)
	&\iff x \in A \land y \in (B - C) \\
	&\iff x \in A \land (y \in B \land y \notin C) \\
	&\iff (x \in A \land y \in B \land x \notin A)
		\lor (x \in A \land y \in B \land y \notin C) \\
	&\iff (x \in A \land y \in B) \land (x \notin A \lor y \notin C) \\
	&\iff (x \in A \land y \in B) \land \neg(x \in A \land y \in C) \\
	&\iff w \in A \times B \land w \notin A \times C,
\end{align*}
那么由外延公理可知\(A \times (B - C) = (A \times B) - (A \times C)\).
\end{proof}
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P38. Exercise 2.(b)
证明：如果\(A \times B = A \times C\)且\(A \neq \emptyset\)，则\(B = C\).
%TODO
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P38. Exercise 3.
证明：\(A \times \bigcup B = \bigcup\Set{ A \times X \given X \in B }\).
%TODO
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P38. Exercise 5.(a)
设\(A,B\)都是集合，试证：\(\Set{ \{x\} \times B \given x \in A }\)也是集合.
%TODO
\end{example}

\subsection{关系}
\begin{definition}
\DefineConcept{关系}（relation）是有序对的集合.
\end{definition}

如果有序对\(\opair{x,y}\)是关系\(\rel{R}\)的元素，即\[
	\opair{x,y} \in \rel{R},
\]
那么称“\(x\)与\(y\)有\(\rel{R}\)关系”，
记作\(x\rel{R}y\)；
反之，\[
	\opair{x,y} \notin \rel{R},
\]
那么称“\(x\)与\(y\)没有\(\rel{R}\)关系”.

给定集合\(X\)和集合\(Y\)，
如果关系\(\rel{R}\)满足\[
	\rel{R} \subseteq X \times Y,
\]
我们就称“\(\rel{R}\)是\(X\)与\(Y\)之间的\DefineConcept{二元关系}（binary relation）”.
特别地，当\(X = Y\)时，就称“\(\rel{R}\)是\(X\)上的\DefineConcept{二元关系}”.

从关系的定义可以看出，关系是有序对的集合.
即便是看起来毫无意义的，只由一个有序对组成的集合，也可以看成是一个关系.
我们自然会认为有的关系比别的关系更有意义，
例如我们马上会提到的“映射”“等价关系”和“排序关系”.

\begin{definition}\label{definition:集合论.定义域与值域的定义}
设\(R\)是集合.

如果集合\(A\)满足\[
	x \in A \iff \exists y \bigl( \opair{x,y} \in R \bigr),
\]
那么称\(A\)为“\(R\)的\DefineConcept{定义域}（domain）”，记作\(\dom R\).

如果集合\(B\)满足\[
	x \in B \iff \exists t \bigl( \opair{t,x} \in R \bigr),
\]
那么称\(B\)为“\(R\)的\DefineConcept{值域}（range）”，记作\(\ran R\).

最后，我们把\(R\)的定义域与它的值域的并集称为
“\(R\)的\DefineConcept{域}（field）”，记作\(\fld R\)，即\[
	\fld R \defeq \dom R \cup \ran R.
\]
\end{definition}

为了正当化\cref{definition:集合论.定义域与值域的定义}，
我们必须明确：对于任意集合\(R\)，存在这样一个集合，
\(R\)中的有序对的第一坐标和第二坐标都是这个集合的元素.
这个问题类似于我们之前对于直积\(A \times B\)的定义的正当化，
当时我们证明了\cref{theorem:集合论.直积存在定理}.
为此，我们给出下述引理，
可以注意到它与\cref{theorem:集合论.有序对是其坐标元素所在集合的二重幂集的元素} 的关联.

\begin{lemma}
%@see: 《Elements of Set Theory》 P38. Lemma 3D
如果\(\opair{x,y} \in A\)，那么\(x,y \in \bigcup\bigcup A\).
\end{lemma}
这条引理已经在\cref{example:集合论.有序对各坐标的取值范围} 得到证明.
利用这条引理，再加上子集公理，我们可以构造集合\(R\)的定义域和值域：
\begin{gather}
	\dom R
	\defeq
	\Set*{ x \in \bigcup\bigcup R \given \exists y \bigl( \opair{x,y} \in R \bigr) }, \\
	\ran R
	\defeq
	\Set*{ x \in \bigcup\bigcup R \given \exists t \bigl( \opair{t,x} \in R \bigr) }.
\end{gather}

\begin{example}
%@see: 《Elements of Set Theory》 P41. Exercise 6.
试证：集合\(A\)是一个关系的充要条件是\[
	A \subseteq \dom A \times \ran A.
\]
%TODO
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P41. Exercise 7.
试证：给定关系\(\rel{R}\)，总有\[
	\fld \rel{R} = \bigcup\bigcup \rel{R}.
\]
%TODO
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P41. Exercise 8.
试证：对于任意集合\(A\)，总有\begin{gather}
	\dom\bigcup A = \bigcup\Set{ \dom\rel{R} \given \rel{R} \in A }, \\
	\ran\bigcup A = \bigcup\Set{ \ran\rel{R} \given \rel{R} \in A }.
\end{gather}
%TODO
\end{example}

\subsection{多元关系}
我们可以将“有序对”和“二元关系”的概念分别扩展为“元组”和“多元关系”.

例如定义\[
	\opair{x_1,x_2,x_3}
	\defeq
	\opair{\opair{x_1,x_2},x_3},
\]
称之为\DefineConcept{三元组}（triple）；
定义\[
	\opair{x_1,x_2,x_3,x_4}
	\defeq
	\opair{\opair{x_1,x_2,x_3},x_4},
\]
称之为\DefineConcept{四元组}（quadruple）；
定义\[
	\opair{x_1,x_2,x_3,x_4,x_5}
	\defeq
	\opair{\opair{x_1,x_2,x_3,x_4},x_5},
\]
称之为\DefineConcept{五元组}（quintuple）；
以此类推，对于任意给定\(n\)，可以定义\(n\)元组（\(n\)-tuple）：\[
	\opair{x_1,x_2,\dotsc,x_n}
	\defeq
	\opair{\opair{x_1,x_2,\dotsc,x_{n-1}},x_n}.
\]
为了让我们的定义看起来整齐划一，我们还可以补充定义\[
	\opair{x} \defeq x,
\]
称之为\DefineConcept{一元组}（1-tuple）.

我们把“在\(A\)上的\(n\)元\DefineConcept{关系}（n-ary \emph{relation} on \(A\)）”%
定义为由\(n\)元组构成的集合.
由于\(A\)上的二元关系是\(A \times A\)的子集，
以及\(A\)上的三元关系（ternary relation, 3-ary relation）是\((A \times A) \times A\)的子集，
所以三元关系也可归结为一种二元关系；
同理，其他\(n\)元关系，只要\(n>1\)，也都可以归结为二元关系.
虽然在上面对\(n\)元关系的定义中，
我们也把由\(A\)中包括的一元组构成的集合称为%
“\(A\)上的一元关系（unary relation, 1-ary relation）”，
但它只是\(A\)的一个子集，根本不满足关系的定义.

\section{映射}
\subsection{映射的概念}
\begin{definition}
设\(F\)是关系，如果\[
	\forall x \in \dom F, \exists! y:
	x F y,
\]
则称“关系\(F\)是一个\DefineConcept{映射}（function）”.
\end{definition}
可以从映射的定义中看出，虽然映射也是关系，
但映射有一般的关系所没有的特殊性质：
映射是\DefineConcept{单值的}（single-valued）.
换句话说，对于关系\(F\)，每个\(x\)可能对应若干个\(y\)；
但是，对于映射\(F\)，每个\(x\)就只对应一个\(y\).
我们可以把\(x\)与\(y\)这两个元素之间的对应关系记为\(x \mapsto y\).

我们把使得\(xFy\)成立的\(y\)称为“\(x\)（在映射\(F\)下）的\DefineConcept{像}%
（the \emph{value} of \(F\) at \(x\)）”，
记为\(F(x)\)，即\[
	y = f(x);
\]
称\(x\)为“\(y\)（在映射\(F\)下）的一个\DefineConcept{原像}”.
这里用的\(F(x)\)符号是欧拉提出的，
我们仅当\(F\)是一个映射且\(x\in\dom F\)时使用这个记号.
不过，我们也可以定义：\[
	F(x) \defeq \bigcup\Set{ y \given \opair{x,y} \in F }.
\]
它对于任意\(F\)和\(x\)都有意义.

映射是如此重要，以至于各家对用于描述映射的术语没有达成统一.
以下是两种最常采用的术语.

设\(X,Y\)都是集合，
如果\(f\)是一个映射，且\(\dom f = X\)，\(\ran f \subseteq Y\)，
则称“\(f\)是从\(X\)到\(Y\)的\DefineConcept{映射}%
（\(f\) is a function \emph{from} \(X\) \emph{into} \(Y\)）”，
或称“\(f\)将\(X\)映射到\(Y\)里%
（\(f\) \emph{maps} \(X\) \emph{into} \(Y\)）”，
记作\[
	f\colon X \to Y.
\]
如果还有\(\ran f = Y\)，
那么称“\(f\)是从\(X\)到\(Y\)上的映射%
（\(f\) is a function from \(X\) \emph{onto} \(Y\)）”，
或称“\(f\)将\(X\)映射到\(Y\)上%
（\(f\) \emph{maps} \(X\) \emph{onto} \(Y\)）”，
或称“\(f\)是\DefineConcept{满射}（surjective）”.
我们可以说“任意映射总将它的定义域映射到它的值域上”，
还可以说“任意映射总把它的定义域映射到以它的值域为子集的任意集合\(B\)里”.
注意到两种说法的区别，“上”字和“里”字的选用，
不光取决于映射\(f\)本身，还取决于我们讨论的集合\(B\).

如果\[
	\forall y \in \ran f,
	\exists! x \bigl( x f y \bigr),
\]
那么称“映射\(f\)是\DefineConcept{一一映射}（one-to-one）”.

有时候我们希望把一一映射的概念套用到一般的关系上，
它们往往不是映射，因此“一一映射”这个用词就显得不那么恰当了.
为此，我们创造出“单根的”，类比于“单值的”.

\begin{definition}
如果集合\(R\)满足\[
	\forall y \in \ran R,
	\exists! x:
	x R y,
\]
则称“\(R\)是\DefineConcept{单根的}（single-rooted）”.
\end{definition}

因此，我们可以说，“一个映射是单根的”当且仅当“这个映射是一一映射”.

如果\[
	\forall x_1, x_2 \in \dom f
	\bigl[ x_1 \neq x_2 \implies f(x_1) \neq f(x_2) \bigr],
\]
那么称“\(f\)是\DefineConcept{单射}（injective）”.
由于映射本就是单值的，若它还是单根的，那么这个映射就是单射；
换句话说，一一映射和单射是相同的概念.

如果\(f\)既是单射，又是满射，即
那么称“\(f\)是\DefineConcept{双射}（bijective）\footnote{%
有的书可能会把双射称作一一映射，但是我们不采取这种说法.
}”.


\begin{example}
设\(f\colon A \to B, g\colon B \to C\).
证明：\begin{enumerate}
	\item 如果\(f\)和\(g\)都是单射，那么\(g \circ f\)也是单射；
	\item 如果\(f\)和\(g\)都是满射，那么\(g \circ f\)也是满射；
	\item 如果\(f\)和\(g\)都是双射，那么\(g \circ f\)也是双射；
	\item 如果\(f\)和\(g\)都是可逆映射，那么\(g \circ f\)也是可逆映射.
\end{enumerate}
\begin{proof}
当\(f\)和\(g\)都是单射时.设\(a_1,a_2 \in A\).
如果\((g \circ f)(a_1) = (g \circ f)(a_2)\)，那么\(g[f(a_1)] = g[f(a_2)]\).
由于\(g\)是单射，因此\(f(a_1) = f(a_2)\).
由于\(f\)是单射，因此\(a_1 = a_2\).
综上，\(g \circ f\)是单射.

当\(f\)和\(g\)都是满射时.任取\(c \in C\).
由于\(g\)是满射，因此存在\(b \in B\)，使得\(c = g(b)\).
由于\(f\)是满射，因此存在\(a \in A\)，使得\(b = f(a)\).
因此\(c = g(b) = g[f(a)] = (g \circ f)(a)\)，也就是说\(g \circ f\)是满射.

双射的情形，根据单射、满射的情形显然成立.

可逆映射的情形，根据双射的情形以及\cref{theorem:集合论.映射可逆的充要条件} 即得.
\end{proof}
\end{example}


\subsection{逆，复合，限制，像，原像}
以下定义的操作通常用在映射上，有时候也用于关系，但也可以用于任意集合.
\begin{definition}
设\(A,F,G\)都是集合.
\begin{enumerate}
	\item 称集合\[
		\Set*{ \opair{u,v} \given v F u }
	\]为“\(F\)的\DefineConcept{逆}%
	（the \emph{inverse} of \(F\)）”，
	记作\(F^{-1}\).

	特别地，如果\(F^{-1}\)是映射，
	则称“\(F^{-1}\)是\(F\)的\DefineConcept{逆映射}”.

	\item 称集合\[
		\Set*{ \opair{u,v} \given \exists t \bigl( u G t \land t F v \bigr) }
	\]为“\(F\)和\(G\)的\DefineConcept{复合}%
	（the \emph{composition} of \(F\) and \(G\)）”，
	记作\(F \circ G\).

	\item 称集合\[
		\Set*{ \opair{u,v} \given u F v \land u \in A }
	\]为“\(F\)在\(A\)上的\DefineConcept{限制}%
	（the \emph{restriction} of \(F\) to \(A\)）”，
	记作\(F \upharpoonright A\).

	\item 称集合\[
		\Set*{ v \given \exists u \in A \bigl( u F v \bigr) }
	\]为“\(A\)在\(F\)下的\DefineConcept{像}%
	（the \emph{image} of \(A\) \emph{under} \(F\)）”，
	记作\(F\ImageOfSetUnderRelation{A}\).
\end{enumerate}
\end{definition}

当\(F\)是一个映射，且\(A \subseteq \dom F\)时，
\(F\ImageOfSetUnderRelation{A}\)这个概念可能更容易理解，
因为这时候\[
	F\ImageOfSetUnderRelation{A}
	= \Set{ F(u) \given u \in A }.
\]

我们可以利用子集公理构造出上述定义下的所需集合的存在性.
特别地，\[
	F^{-1} \subseteq \ran F \times \dom F, \qquad
	F \circ G \subseteq \dom G \times \ran F,
\]\[
	F \upharpoonright A \subseteq F, \qquad
	F\ImageOfSetUnderRelation{A} \subseteq \ran F.
\]

例如，我们可以按如下方法正当化“关系\(F\)的逆”的定义：
根据子集公理，存在集合\(B\)，使得对于任意\(x\)，总有\begin{align*}
	x \in B
	&\iff
	x \in \ran F \times \dom F
	\land
	\exists u, \exists v \bigl( x = \opair{u,v} \land v F u \bigr), \\
	&\iff
	\exists u, \exists v \bigl( x = \opair{u,v} \land v F u \bigr).
\end{align*}
再根据外延公理，可以保证集合\(B\)的唯一性.
因此我们可以将集合\(B\)记为\(F^{-1}\).

\begin{theorem}
\(F \upharpoonright \emptyset = \emptyset\).
\end{theorem}

\begin{theorem}
\(F\ImageOfSetUnderRelation{A} = \ran(F \upharpoonright A)\).
\begin{proof}
根据值域的定义有\begin{align*}
	v \in \ran(F \upharpoonright A)
	&\iff
	\exists u \bigl( \opair{u,v} \in F \upharpoonright A \bigr) \\
	&\iff
	\exists u \bigl( u F v \land u \in A \bigr) \\
	&\iff
	v \in F\ImageOfSetUnderRelation{A}.
	\qedhere
\end{align*}
\end{proof}
\end{theorem}

\begin{definition}
设\(F\)是关系，\(A\)是集合，那么称集合\[
	\Set*{ x \in \dom F \given F(x) \in A }
\]为“集合\(A\)在关系\(F\)下的\DefineConcept{原像}%
（the \emph{inverse image} of \(A\) under \(F\)）”，
记作\(F^{-1}\ImageOfSetUnderRelation{A}\).
\end{definition}

\begin{theorem}\label{theorem:集合论.关系的逆的定义域值域以及关系的二重逆}
%@see: 《Elements of Set Theory》 P46. Theorem 3E
设\(F\)是集合，则有\begin{gather}
	\dom F^{-1} = \ran F, \\
	\ran F^{-1} = \dom F.
\end{gather}

如果\(F\)是关系，则有\begin{equation}
	(F^{-1})^{-1} = F.
\end{equation}
\end{theorem}

\begin{theorem}\label{theorem:集合论.关系及其逆是映射的充要条件}
%@see: 《Elements of Set Theory》 P46. Theorem 3F
设\(F\)是集合，则“\(F^{-1}\)是映射”的充要条件是：\(F\)是单根的.

设\(F\)是关系，则“\(F\)是映射”的充要条件是：\(F^{-1}\)是单根的.
\end{theorem}

\begin{theorem}\label{theorem:集合论.映射可逆的充要条件}
映射\(f\)可逆的充要条件是：\(f\)是双射.
\end{theorem}

\begin{theorem}
%@see: 《Elements of Set Theory》 P46. Theorem 3G
设\(F\)是一一映射.
\begin{enumerate}
	\item 如果\(x \in \dom F\)，那么\[
		F^{-1}(F(x)) = x.
	\]

	\item 如果\(y \in \ran F\)，那么\[
		F(F^{-1}(y)) = y.
	\]
\end{enumerate}
\begin{proof}
假设\(x \in \dom F\)，
那么\(\opair{x,F(x)} \in F\)，且\(\opair{F(x),x} \in F^{-1}\)，
于是\(F(x) \in \dom F^{-1}\).
因为\(F\)是一一映射，是单值的，所以\(F^{-1}\)是映射，
从而\(x = F^{-1}(F(x))\).

如果\(y \in \ran F\)，
那么根据本定理第1条，以及\((F^{-1})^{-1} = F\)，可知\[
	F(F^{-1}(y)) = (F^{-1})^{-1}(F^{-1}(y)) = y.
	\qedhere
\]
\end{proof}
\end{theorem}

\begin{theorem}
%@see: 《Elements of Set Theory》 P47. Theorem 3H
设\(F,G\)都是映射，则\(F \circ G\)是映射，且\[
	\dom(F \circ G)
	= \Set*{ x \in \dom G \given G(x) \in \dom F },
\]\[
	\forall x \in \dom(F \circ G):
	(F \circ G)(x) = F(G(x)).
\]
\begin{proof}
要证\(F \circ G\)是一个映射，
假设有\(x (F \circ G) y\)和\(x (F \circ G) z\)同时成立.
那么，\(\exists p,q\)，有\[
	x G p \land p F y
	\quad\text{和}\quad
	x G q \land q F z
\]同时成立.
既然\(G\)是映射，必有\(p = q\).
同理，\(F\)是映射，必有\(y = z\).
因此\(F \circ G\)是映射.

现在再假设\(x \in \dom G\)且\(G(x) \in \dom F\).
我们必须证明\[
	x \in \dom(F \circ G)
	\quad\text{和}\quad
	(F \circ G)(x) = F(G(x)).
\]
我们知道\[
	\opair{x,G(x)} \in G,
	\qquad
	\opair{G(x),F(G(x))} \in F.
\]
因此\(\opair{x,F(G(x))} \in F \circ G\).

反过来说，如果\(x \in \dom(F \circ G)\)，
那么就有\[
	\exists y, \exists t
	\bigl( x G t \land t F y \bigr).
\]
于是就有\(x \in \dom G\)和\(t = G(x) \in \dom F\).
\end{proof}
\end{theorem}

容易看出，映射的复合是有顺序的，\(f \circ g\)有意义并不代表\(g \circ f\)也有意义.
即便两者都有意义，它们也未必相同.

\begin{theorem}
%@see: 《Elements of Set Theory》 P65. Exercise 53.
设\(R,S\)是集合，那么\begin{gather}
	(R \cup S)^{-1} = R^{-1} \cup S^{-1},
	\label{equation:集合论.并的逆等于逆的并} \\
	(R \cap S)^{-1} = R^{-1} \cap S^{-1},
	\label{equation:集合论.交的逆等于逆的交} \\
	(R - S)^{-1} = R^{-1} - S^{-1}.
	\label{equation:集合论.差的逆等于逆的差}
\end{gather}
\begin{proof}
对\cref{equation:集合论.并的逆等于逆的并} 证明如下：
\begin{align*}
	\opair{x,y} \in (R \cup S)^{-1}
	&\iff \opair{y,x} \in R \cup S \\
	&\iff \opair{y,x} \in R \lor \opair{y,x} \in S \\
	&\iff \opair{x,y} \in R^{-1} \lor \opair{x,y} \in S^{-1} \\
	&\iff \opair{x,y} \in R^{-1} \cup S^{-1}.
\end{align*}

对\cref{equation:集合论.交的逆等于逆的交} 证明如下：
\begin{align*}
	\opair{x,y} \in (R \cap S)^{-1}
	&\iff \opair{y,x} \in R \cap S \\
	&\iff \opair{y,x} \in R \land \opair{y,x} \in S \\
	&\iff \opair{x,y} \in R^{-1} \land \opair{x,y} \in S^{-1} \\
	&\iff \opair{x,y} \in R^{-1} \cap S^{-1}.
\end{align*}

对\cref{equation:集合论.差的逆等于逆的差} 证明如下：
\begin{align*}
	\opair{x,y} \in (R - S)^{-1}
	&\iff \opair{y,x} \in R - S \\
	&\iff \opair{y,x} \in R \land \opair{y,x} \notin S \\
	&\iff \opair{x,y} \in R^{-1} \land \opair{x,y} \notin S^{-1} \\
	&\iff \opair{x,y} \in R^{-1} - S^{-1}.
	\qedhere
\end{align*}
\end{proof}
\end{theorem}

\begin{theorem}
%@see: 《Elements of Set Theory》 P47. Theorem 3I
设\(F,G\)都是集合，那么\[
	(F \circ G)^{-1} = G^{-1} \circ F^{-1}.
\]
\begin{proof}
易知\((F \circ G)^{-1}\)和\(G^{-1} \circ F^{-1}\)都是关系，且\begin{align*}
	\opair{x,y} \in (F \circ G)^{-1}
	&\iff
	\opair{y,x} \in F \circ G \\
	&\iff
	\exists t \bigl( y G t \land t F x \bigr) \\
	&\iff
	\exists t \bigl( x F^{-1} t \land t G^{-1} y \bigr) \\
	&\iff
	\opair{x,y} \in G^{-1} \circ F^{-1}.
	\qedhere
\end{align*}
\end{proof}
\end{theorem}

\begin{axiom}[选择公理(第一种形式)]
对于任意关系\(R\)，存在映射\(H\)，满足\[
	H \subseteq R,
	\quad\text{且}\quad
	\dom H = \dom R.
\]
\end{axiom}

\begin{theorem}
%@see: 《Elements of Set Theory》 P48. Theorem 3J
设映射\(F\colon A \to B\)，其中\(A\)是非空集合.
\begin{enumerate}
	\item “存在映射\(G\colon B \to A\)（称其为\DefineConcept{左逆}），
	使得\(G \circ F\)是\(A\)上的恒等映射\(I_A\)”是“\(F\)是一一映射”的充要条件.

	\item “存在映射\(H\colon B \to A\)（称其为\DefineConcept{右逆}），
	使得\(F \circ H\)是\(B\)上的恒等映射\(I_B\)”是“\(F\)是满射”的充要条件.
\end{enumerate}
\begin{proof}
\begin{enumerate}
	\item
	先证充分性.
	我们假设存在映射\(G\)使得\(G \circ F = I_A\).
	如果\(F(x) = F(y)\)，那么\[
		x = G(F(x)) = G(F(y)) = y,
	\]
	于是\(F\)是一一映射.

	再证必要性.
	假设\(F\)是一一映射，
	那么根据\cref{theorem:集合论.关系的逆的定义域值域以及关系的二重逆,theorem:集合论.关系及其逆是映射的充要条件}，
	\(F^{-1}\)是一个从\(\ran F\)到\(A\)上的映射.
	现在我们需要将\(F^{-1}\)延拓为以\(B\)为定义域的映射\(G\).
	因为\(A\)是非空集合，
	于是我们可以取定\(a \in A\)，
	然后令\[
		G(x) = \left\{ \begin{array}{ll}
			F^{-1}(x), & x \in \ran F, \\
			a, & x \in B - \ran F,
		\end{array} \right.
	\]或者令\[
		G = F^{-1} \cup (B - \ran F) \times \Set{a}.
	\]
	这个构造出来的映射\(G\)是一个从\(B\)到\(A\)里的映射，
	且满足\[
		\dom(G \circ F) = A,
	\]
	以及\[
		\forall x \in A: G(F(x)) = F^{-1}(F(x)) = x,
	\]
	于是\(G \circ F = I_A\)成立.

	\item
	我们还是先证充分性.
	假设存在映射\(H\)使得\(F \circ H = I_B\).
	那么\[
		\forall y \in B: y = F(H(y)),
	\]
	从而\(y \in \ran F\)，
	于是\(\ran F = B\).

	必要性的证明稍显困难.
	我们不能直接取\(H = F^{-1}\)，
	因为一般而言\(F\)不会是一一映射，
	\(F^{-1}\)也不会是一个映射.
	假设\(F\)将\(A\)映射到\(B\)上，\(\ran F = B\).
	现在我们需要为每个\(y \in B\)选择某个\(x\)，使得\(F(x) = y\)，然后令\(H(y) = x\)；
	考虑到\(y \in \ran F\)，这样的\(x\)必定存在.
	虽然我们知道对于每个\(y\)，存在一个合适的\(x\)，
	但是我们无法据此构造所求映射\(H\).
	因此，我们需要引入选择公理.
	借助选择公理，我们可以令映射\(H\)满足\(H \subseteq F^{-1}\)且\(\dom H = \dom F^{-1} = B\).
	于是\(H\)满足\[
		\forall y \in B
		\bigl[
		\opair{y,H(y)} \in F^{-1}
		\iff \opair{H(y),y} \in F
		\iff F(H(y)) = y
		\bigr].
		\qedhere
	\]
\end{enumerate}
\end{proof}
\end{theorem}

\begin{theorem}
%@see: 《Elements of Set Theory》 P48. Theorem 3K
设\(A,B,F\)都是集合.
\def\F#1{F\ImageOfSetUnderRelation{#1}}
\begin{enumerate}
	\item 并的像是像的并：\begin{gather}
		\F{A \cup B}
		= \F{A} \cup \F{B},
		\label{equation:集合论.并的像与像的并的关系1} \\
		\F{\bigcup A}
		= \bigcup\Set{ \F{a} \given a \in A }.
		\label{equation:集合论.并的像与像的并的关系2}
	\end{gather}

	\item 交的像包含于像的交：\begin{gather}
		\F{A \cap B}
		\subseteq \F{A} \cap \F{B},
		\label{equation:集合论.交的像与像的交的关系1} \\
		\F{\bigcap A}
		\subseteq \bigcap\Set{ \F{a} \given a \in A }.
		\label{equation:集合论.交的像与像的交的关系2}
		\quad(A \neq \emptyset)
	\end{gather}
	若\(F\)是单根的，则以上两式取“=”号.

	\item 差的像包含像的差：\begin{equation}
		\F{A} - \F{B}
		\subseteq \F{A-B}.
		\label{equation:集合论.差的像与像的差的关系}
	\end{equation}
	若\(F\)是单根的，则上式取“=”号.
\end{enumerate}
\begin{proof}
\cref{equation:集合论.并的像与像的并的关系1} 证明如下：
\begin{align*}
	y \in \F{A \cup B}
	&\iff \exists x \in A \cup B \bigl( x F y \bigr) \\
	&\iff \bigl[ \exists x \in A \bigl( x F y \bigr) \bigr]
			\lor \bigl[ \exists x \in B \bigl( x F y \bigr) \bigr] \\
	&\iff y \in \F{A} \lor y \in \F{B}.
\end{align*}

\cref{equation:集合论.交的像与像的交的关系1} 证明如下：
\begin{align*}
	y \in \F{A \cap B}
	&\iff \exists x \in A \cap B \bigl( x F y \bigr) \\
	&\implies \bigl[ \exists x \in A \bigl( x F y \bigr) \bigr]
			\land \bigl[ \exists x \in B \bigl( x F y \bigr) \bigr] \\
	&\iff y \in \F{A} \land y \in \F{B}.
\end{align*}
注意到中间步骤的\(\implies\)不总是可逆的，
这时因为虽然有\[
	\exists x_1 \in A \bigl( x_1 F y \bigr), \qquad
	\exists x_2 \in B \bigl( x_2 F y \bigr),
\]
但是可能\[
	\nexists x \in A \cap B \bigl( x F y \bigr).
\]
不过，如果\(F\)是单根的，那么必有\(x_1 = x_2 \in A \cap B\)，
这时候中间步骤的\(\implies\)是可逆的，可以改为\(\iff\).

\cref{equation:集合论.并的像与像的并的关系2,equation:集合论.交的像与像的交的关系2} 分别是%
\cref{equation:集合论.并的像与像的并的关系1,equation:集合论.交的像与像的交的关系1} 的简单推广，
故略去证明.

\cref{equation:集合论.差的像与像的差的关系} 证明如下：
\begin{align*}
	y \in \F{A} - \F{B}
	&\iff \bigl[ \exists x \in A \bigl( x F y \bigr) \bigr]
			\land \neg\bigl[ \exists t \in B \bigl( t F y \bigr) \bigr] \\
	&\implies \exists x \in A - B \bigl( x F y \bigr) \\
	&\iff y \in \F{A - B}.
\end{align*}
若\(F\)是单根的，则\[
	\exists! x \bigl( x F y \bigr).
\]
这种情况下，中间步骤的\(\implies\)可以改为\(\iff\).
\end{proof}
\end{theorem}

\begin{corollary}
%@see: 《Elements of Set Theory》 P48. Corollary 3L
设\(G\)是映射，\(A,B\)都是集合.
\def\G#1{G^{-1}\ImageOfSetUnderRelation{#1}}
\begin{gather}
	\G{\bigcup A} = \bigcup\Set*{ \G{a} \given a \in A },
	\label{equation:集合论.并的原像与原像的并的关系} \\
	\G{\bigcap A} = \bigcap\Set*{ \G{a} \given a \in A }, \quad A \neq \emptyset,
	\label{equation:集合论.交的原像与原像的交的关系} \\
	\G{A - B} = \G{A} - \G{B}.
	\label{equation:集合论.差的原像与原像的差的关系}
\end{gather}
\end{corollary}

\begin{example}
%@see: 《Elements of Set Theory》 P53. Exercise 22.(a)
\def\F#1{F\ImageOfSetUnderRelation{#1}}
证明：\begin{equation}
	A \subseteq B \implies \F{A} \subseteq \F{B}.
\end{equation}
\begin{proof}
因为\(A \subseteq B\)，所以\(A \cap B = A\)，
那么由\cref{equation:集合论.交的像与像的交的关系1} 可知，\[
	\F{A} = \F{A \cap B} \subseteq \F{A} \cap \F{B} \subseteq \F{B}.
	\qedhere
\]
\end{proof}
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P65. Exercise 59.
设\(A,B,Q\)是集合.
证明：\begin{gather}
	Q \upharpoonright (A \cap B)
	= (Q \upharpoonright A) \cap (Q \upharpoonright B), \\
	Q \upharpoonright (A - B)
	= (Q \upharpoonright A)
	- (Q \upharpoonright B).
\end{gather}
%TODO
\end{example}

\begin{example}
%@see: 《Elements of Set Theory》 P65. Exercise 60.
设\(A,R,S\)是集合.
证明：\begin{equation}
	(R \circ S) \upharpoonright A = R \circ (S \upharpoonright A).
\end{equation}
%TODO
\end{example}

\subsection{指标集}
\begin{definition}
设\(F\)是映射，\(I\)是集合，\(\dom F \supseteq I\)，定义：\[
	\bigcup\limits_{i \in I} F(i) \defeq \bigcup\Set{ F(i) \given i \in I },
\]\[
	\bigcap\limits_{i \in I} F(i) \defeq \bigcap\Set{ F(i) \given i \in I }.
\]
称\(I\)为“\(\bigcup\limits_{i \in I} F(i)\)、\(\bigcap\limits_{i \in I} F(i)\)的%
\DefineConcept{指标集}（\emph{index} set）”.
\end{definition}

\subsection{映射空间}
对于任意给定的集合\(A,B\)，
我们可以构造出这样一个收集，
它是由从\(A\)到\(B\)的映射组成的，定义：\[
	^AB \defeq \Set{ F \given F\ \text{是从\(A\)到\(B\)的映射} }.
\]
我们把这个收集称为“从\(A\)到\(B\)的\DefineConcept{映射空间}”.

因为\(F\colon A \to B\)必有\(F \subseteq A \times B\)，\(F \in \Powerset(A \times B)\)，
所以我们可以对集合\(\Powerset(A \times B)\)利用子集公理，构造包括全部从\(A\)到\(B\)的映射的集合.

记号\(^AB\)读作“\(B\)前\(A\)（\(B\)-pre-\(A\)）”.
之所以采取这种表记方式，
是因为当\(A\)和\(B\)是有限集，且\(\abs{A}=a,\abs{B}=b\)时，
\(\abs{^AB}=b^a\).

容易看出，对于非空集合\(A\)，总有\(^A\emptyset = \emptyset\)；
这是因为没有哪个映射会同时有非空的定义域和空的值域.
另一方面，对于任意集合\(A\)，总有\(^\emptyset A = \Set{\emptyset}\)；
这是因为“空映射”\(\emptyset\colon \emptyset \to A\)的存在，
空映射是唯一的以空集为定义域的映射.
作为特例，我们还有\(^\emptyset\emptyset=\Set{\emptyset}\).

\section{无穷直积}
我们在前面学习了有限个集合的直积，
但让我们更好奇的是：
存不存在无限个集合的直积呢？
取集合\(I\)作为指标集，
设映射\(H\)的定义域包含\(I\)，
那么对于\(I\)中的每个\(i\)，总可得集合\(H(i)\).
我们定义：\[
	\BigTimes_{i \in I} H(i)
	\defeq
	\Set{ f \given f \ \text{是一个以\(I\)为定义域的映射},
	\forall i \in I \bigl[ f(i) \in H(i) \bigr] }.
\]
易见\(\BigTimes_{i \in I} H(i)\)的元素都是“\(I\)元组（\(I\)-tuples）”（即以\(I\)为定义域的映射），
这些“元组”的“第\(i\)坐标”（即\(i\)在这些映射下的像）是\(H(i)\)中的元素.

注意到\(\BigTimes_{i \in I} H(i)\)的元素都是从\(I\)到\(\bigcup_{i \in I} H(i)\)的映射，
显然这些元素也都是映射空间\[
	\mathcal{H} = \vphantom{.}^I\left(\bigcup_{i \in I} H(i)\right)
\]的元素，
于是集合\(\BigTimes_{i \in I} H(i)\)可以通过对映射空间\(\mathcal{H}\)使用子集公理构造得到.

\begin{example}
如果存在集合\(A\)，对\(\forall i \in I\)，有\(H(i) = A\)，那么\[
	\BigTimes_{i \in I} H(i) = \vphantom{.}^IA.
\]
\end{example}

应该注意到，
如果某个\(H(i)\)是空集，
那么无穷直积\(\BigTimes_{i \in I} H(i)\)也将是空集.
反过来说，假设\(\forall i \in I \bigl( H(i) \neq \emptyset \bigr)\)，
我们能不能说\(\BigTimes_{i \in I} H(i) \neq \emptyset\)呢？
为了得到这个无穷直积的一个元素\(f\)，
我们需要从每个\(H(i)\)中选择一些元素，
令\(f(i)\)等于这些选定的元素.
这就需要用到选择公理，
而且实际上这也是选择公理的若干等价表述方式之一.

\begin{axiom}[选择公理(第二种形式)]
对于任意集合\(I\)和任意以\(I\)为定义域的映射\(H\)，
如果\(H(i) \neq \emptyset\ (i \in I)\)，
那么\(\BigTimes_{i \in I} H(i) \neq \emptyset\).
\end{axiom}

\section{等价关系}
\subsection{等价关系}
\begin{definition}
设\(\rel{R}\)是集合\(A\)上的二元关系，即\(\rel{R} \subseteq A^2\).
\begin{itemize}
	\item 对于\(\forall x \in A\)，若满足\[
		x\rel{R}x,
	\]
	则称“关系\(\rel{R}\)具有\DefineConcept{自反性}（reflexive）”；

	\item 对于\(\forall x,y \in A\)，若\[
		x\rel{R}y \implies y\rel{R}x,
	\]
	则称“关系\(\rel{R}\)具有\DefineConcept{对称性}（symmetric）”；

	\item 对于\(\forall x,y,z \in A\)，若\[
		x\rel{R}y \land y\rel{R}z \implies x\rel{R}z,
	\]
	则称“关系\(\rel{R}\)具有\DefineConcept{传递性}（transitive）”.
\end{itemize}
\end{definition}

\begin{example}
%@see: 《Elements of Set Theory》 P61. Exercise 32.
%@see: 《Elements of Set Theory》 P61. Exercise 33.
设\(\rel{R}\)是集合\(A\)上的二元关系.
证明：\begin{enumerate}
	\item \(\rel{R}\)具有对称性的充要条件是\(\rel{R}^{-1} \subseteq \rel{R}\).
	\item \(\rel{R}\)具有传递性的充要条件是\(\rel{R}\circ\rel{R} \subseteq \rel{R}\).
	\item \(\rel{R}\)同时具有对称性和传递性的充要条件是\(\rel{R} = \rel{R}^{-1}\circ\rel{R}\).
\end{enumerate}
%TODO
\end{example}

\begin{definition}
设\(\rel{R}\)是集合\(A\)上的二元关系，即\(\rel{R} \subseteq A^2\).
如果\(\rel{R}\)同时具有自反性、对称性、传递性，
则称“\(\rel{R}\)是\(A\)上的\DefineConcept{等价关系}（equivalence relation）”.
\end{definition}

\subsection{等价类划分}
\begin{theorem}\label{theorem:集合论.划分集合获得等价关系}
%@see: 《Elements of Set Theory》 P56. Theorem 3M
如果关系\(\rel{R}\)具有对称性和传递性，
那么\(\rel{R}\)是\(\fld \rel{R}\)上的等价关系.
\begin{proof}
任意关系\(\rel{R}\)（不论它是三元的还是四元的）都是它的域上的二元关系，
这是因为\[
	\rel{R}
	\subseteq \dom \rel{R} \times \ran \rel{R}
	\subseteq \fld \rel{R} \times \fld \rel{R}.
\]
已知\(\rel{R}\)具有对称性和传递性，
要证\(\rel{R}\)是\(\fld \rel{R}\)上的等价关系，
只需证\(\rel{R}\)在\(\fld \rel{R}\)上具有自反性.
由于\begin{align*}
	x \in \dom \rel{R}
	&\implies
	\exists y \bigl( x \rel{R} y \bigr) \\
	&\implies
	\exists y \bigl( x \rel{R} y \land y \rel{R} x \bigr)
	&(\text{对称性}) \\
	&\implies
	x \rel{R} x,
	&(\text{传递性})
\end{align*}
可知\(\rel{R}\)在\(\dom \rel{R}\)上具有自反性；
同理，\(x \in \ran \rel{R} \implies x \rel{R} x\)，
即\(\rel{R}\)在\(\ran \rel{R}\)上具有自反性；
所以，\(\rel{R}\)在\(\dom \rel{R} \cup \ran \rel{R} = \fld \rel{R}\)上具有自反性.
\end{proof}
\end{theorem}
一般而言，如果\(\rel{R}\)是一个在\(A\)上兼具对称性和传递性的关系，
它可能不是在\(A\)上的等价关系.
根据\cref{theorem:集合论.划分集合获得等价关系} 我们知道，
这样的\(\rel{R}\)在\(\fld \rel{R}\)上具有自反性，
但\(\fld \rel{R}\)可能只是\(A\)的一个小小的子集.

利用\cref{theorem:集合论.划分集合获得等价关系}，
我们学会通过对集合\(A\)的划分诱导出一个等价关系.
接下来我们来研究怎么逆转这个过程，
也就是说，已知\(A\)上的等价关系，求\(A\)的划分.

\begin{definition}
%@see: 《Elements of Set Theory》 P57. Definition
已知\(\rel{R}\)是一个等价关系.
对于\(x \in \fld \rel{R}\)，集合\[
	\Set{ y \given x \rel{R} y }
\]
称为“\(x\)（在关系\(\rel{R}\)下）的\DefineConcept{等价类}%
（the \emph{equivalence class} of \(x\) (\emph{modulo} \(\rel{R}\))）”，
记作\(\rel{R}[x]\)或\([x]_{\rel{R}}\).
把等价类\(\rel{R}[x]\)中的任意一个元素\(y\)称为%
“\(\rel{R}[x]\)的\DefineConcept{代表}（representative）”.

对不强调关系\(\rel{R}\)时，
也可将上述等价类记为\(\overline{x}\)或\([x]\).
\end{definition}

虽然这里把\(\rel{R}[x]\)叫做等价“类”，
实际上它是实实在在的集合，
这一地位可以由子集公理确保无虞，
这是因为\(\rel{R}[x] \subseteq \ran \rel{R}\).

我们还可以进一步构造等价类的集合，例如\[
	\Set{ \rel{R}[x] \given x \in A },
\]
因为这个集合包含于\(\Powerset(\ran \rel{R})\).

根据等价类的定义，容易得到以下性质.
\begin{property}
设\(\rel{R}\)是\(A\)上的一个等价关系，则有：
\begin{enumerate}
	\item \(x \in A
	\implies \rel{R}[x] \neq \emptyset\).

	\item \(x,y \in A
	\implies \rel{R}[x] = \rel{R}[y]
	\lor \rel{R}[x] \cap \rel{R}[y] = \emptyset\).

	\item \(\forall x,y \in A \bigl( \rel{R}[x] = \rel{R}[y]
	\implies x \rel{R} y
	\iff x \in \rel{R}[y] \land y \in \rel{R}[x] \bigr)\).

	\item \(\forall x,y \in A \bigl( \rel{R}[x] \neq \rel{R}[y]
	\implies \rel{R}[x] \cap \rel{R}[y] = \emptyset \bigr)\).
\end{enumerate}
\end{property}


\begin{lemma}\label{theorem:集合论.相等的等价类的代表等价}
%@see: 《Elements of Set Theory》 P57. Theorem 3N
设\(\rel{R}\)是\(A\)上的一个等价关系，\(x,y \in A\)，
那么\[
	\rel{R}[x] = \rel{R}[y]
	\iff
	x \rel{R} y.
\]
\begin{proof}
首先，设\(\rel{R}[x] = \rel{R}[y]\).
由于等价关系\(\rel{R}\)具有自反性，\(y \rel{R} y\)，\(y \in \rel{R}[y]\)；
那么由\(\rel{R}[x] = \rel{R}[y]\)就有\(y \in \rel{R}[x]\)；
根据等价类\(\rel{R}[x]\)的定义，便得\(x \rel{R} y\).

然后，设\(x \rel{R} y\).
任取\(t\)，若有\(t \in \rel{R}[y]\)，
根据等价类\(\rel{R}[y]\)的定义，
必有\(y \rel{R} t\)；
再根据假设条件\(x \rel{R} y\)，以及等价关系\(\rel{R}\)具有传递性，
立即可得\(x \rel{R} t\)；
那么根据等价类\(\rel{R}[x]\)的定义，
就有\(t \in \rel{R}[x]\)；
因此，\(\rel{R}[y] \subseteq \rel{R}[x]\).
又因为\(\rel{R}\)具有对称性，
从\(x \rel{R} y\)还可得到\(y \rel{R} x\)，
参照上面的推导过程，交换\(x\)和\(y\)符号，
不难得到\(\rel{R}[x] \subseteq \rel{R}[y]\)，
所以\(\rel{R}[x] = \rel{R}[y]\).
\end{proof}
\end{lemma}
从\cref{theorem:集合论.相等的等价类的代表等价} 可以看出，
相等等价类的代表等价，代表等价的等价类相等.

\begin{definition}\label{definition:集合论.划分的定义}
%@see: 《Elements of Set Theory》 P57. Definition
设\(A,\Pi\)都是集合.
若集合\(\Pi\)满足：
\begin{enumerate}
	\item \(\Pi\)中的元素都是\(A\)的非空子集，即\[
		\forall p \in \Pi \bigl(
			p \neq \emptyset
			\land
			p \subseteq A
		\bigr).
	\]

	\item \(\Pi\)中的元素互不重叠，没有交集，即\[
		\forall p_1,p_2 \in \Pi \bigl(
			p_1 \cap p_2 = \emptyset
		\bigr).
	\]

	\item \(A\)中的元素是\(\Pi\)中某个元素的元素，即\[
		\forall a \in A, \exists p \in \Pi \bigl(
			a \in p
		\bigr)
		\quad\text{或}\quad
		\bigcup\Pi = A.
	\]
\end{enumerate}
则称“\(\Pi\)是\(A\)的一个\DefineConcept{划分}（partition）”.
\end{definition}

\begin{theorem}
%@see: 《Elements of Set Theory》 P57. Theorem 3P
设\(\rel{R}\)是\(A\)上的一个等价关系，那么由所有等价类组成的集合\[
	\Pi = \Set{ \rel{R}[x] \given x \in A }
\]就是\(A\)的一个划分.
\begin{proof}
对于任一等价类\(\rel{R}[x]\)，
由于总有\(x \in \rel{R}[x]\)，
它永远不可能是空集；
又因为\(\rel{R}\)是\(A\)上的二元关系，\(\rel{R} \subseteq A^2\)，
\(\rel{R}[x] \subseteq \ran \rel{R}\)，
所以\(\rel{R}[x]\)一定是\(A\)的子集.
因此，\(\Pi\)满足\cref{definition:集合论.划分的定义} 中的第1条和第3条，
也就是说，在这里我们只需要证明第2条：\(\Pi\)中的元素是互不重叠的.
用反证法，设\(\rel{R}[x] \neq \rel{R}[y]\ (x,y \in A)\)，
而且存在\(t \in \rel{R}[x] \cap \rel{R}[y]\)，
于是有\[
	x \rel{R} t \land y \rel{R} t,
	\quad\text{即}\quad
	x \rel{R} y,
\]
再根据\cref{theorem:集合论.相等的等价类的代表等价}，
必有\(\rel{R}[x] = \rel{R}[y]\)，
即\(\rel{R}[x],\rel{R}[y]\)是同一个元素，矛盾！
\end{proof}
\end{theorem}

\begin{definition}
%@see: 《Elements of Set Theory》 P58.
设\(\rel{R}\)是\(A\)上的一个等价关系.
集合\[
	\Set{ \rel{R}[x] \given x \in A }
\]称为“\(A\)在\(\rel{R}\)下的\DefineConcept{划分}”，
或称为“\(A\)对\(\rel{R}\)的\DefineConcept{商集}（quotient set）”，
记作\(A/\rel{R}\)，读作“\(A\)余\(\rel{R}\)（\(A\) modulo \(\rel{R}\)）”.
把映射\[
	\varphi\colon A \to A/\rel{R}, x \mapsto \rel{R}[x]
\]称为\DefineConcept{自然映射}（natural map）%
或\DefineConcept{典范映射}（canonical map）.
\end{definition}
对于一个非空集合\(A\)，通过建立\(A\)上的一个等价关系\(\rel{R}\)，
得到\(A\)对于\(\rel{R}\)的商集\(A/\rel{R}\)，
进而研究商集\(A/\rel{R}\)的性质，
这就是抽象代数的基本方法之一.

现在我们来研究如何在商集上定义映射.
具体而言，设\(\rel{R}\)是\(A\)上的一个等价关系，
映射\(F\colon A \to A\).
我们想知道是否存在一个对应的映射\(\hat{F}\colon A/\rel{R} \to A/\rel{R}\)，
使得对于任意\(x \in A\)，总有\[
	\hat{F}(\rel{R}[x]) = \rel{R}[F(x)].
\]
这里我们可以尝试依靠在等价类\(\rel{R}[x]\)中选择某个特定的元素\(x\)，
定义等价类\(\rel{R}[x]\)在映射\(\hat{F}\)下的值.
不过，假如\(x_1,x_2\)都在同一个等价类中，
那么除非\(F(x_1),F(x_2)\)也都在同一个等价类中，
否则映射\(\hat{F}\)就不是良定的！

为了给出一个一般性结论，我们先了解这样一个概念：
如果\[
	\forall x,y \in A \bigl(
		x \rel{R} y
		\implies
		\opair{F(x),F(y)} \in \rel{R}
	\bigr),
\]
那么我们称“\(F\)和\(\rel{R}\)\DefineConcept{兼容}%
（\(F\) is \emph{compatible} with \(\rel{R}\)）”.

\begin{theorem}\label{theorem:集合论.与等价关系兼容的映射的性质}
%@see: 《Elements of Set Theory》 P60. Theorem 3Q
设\(\rel{R}\)是\(A\)上的一个等价关系，映射\(F\colon A \to A\).
如果\(F\)和\(\rel{R}\)兼容，
那么存在一个唯一的映射\(\hat{F}\colon A/\rel{R} \to A/\rel{R}\)，使得\[
	\forall x \in A:
	\hat{F}(\rel{R}[x]) = \rel{R}[F(x)].
\]
如果\(F\)和\(\rel{R}\)不兼容，
那么不存在映射\(\hat{F}\)满足上述条件.
\begin{proof}
首先假设\(F\)和\(\rel{R}\)不兼容，即\[
	\exists x,y \in A \bigl(
		x \rel{R} y,
		\opair{F(x),F(y)} \notin \rel{R}
	\bigr),
\]
也即\[
	\exists x,y \in A \bigl(
		\rel{R}[x] = \rel{R}[y],
		\rel{R}[F(x)] \neq \rel{R}[F(y)]
	\bigr).
\]
而要使\[
	\forall x \in A:
	\hat{F}(\rel{R}[x]) = \rel{R}[F(x)]
\]成立，必须有\[
	\hat{F}(\rel{R}[x])
	= \rel{R}[F(x)]
	\quad\text{和}\quad
	\hat{F}(\rel{R}[y])
	= \rel{R}[F(y)]
\]同时成立，
但这是不可能的，
毕竟上面两式的左边相等而右边不等.

接下来，我们假设\(F\)和\(\rel{R}\)兼容.
由于结论要求\(\opair{\rel{R}[x],\rel{R}[F(x)]} \in \hat{F}\)，
所以我们可以令\[
	\hat{F} = \Set{ \opair{\rel{R}[x],\rel{R}[F(x)]} \given x \in A }.
\]
现在就需要证明关系\(\hat{F}\)是一个映射.
考虑\(\opair{\rel{R}[x],\rel{R}[F(x)]},
\opair{\rel{R}[y],\rel{R}[F(y)]} \in \hat{F}\)，
由于\begin{align*}
	\rel{R}[x] = \rel{R}[y]
	&\implies
	x \rel{R} y
	&(\text{\cref{theorem:集合论.相等的等价类的代表等价}}) \\
	&\implies
	\opair{F(x),F(y)} \in \rel{R} \\
	&\implies
	\rel{R}[F(x)] = \rel{R}[F(y)],
	&(\text{\cref{theorem:集合论.相等的等价类的代表等价}})
\end{align*}
\(\hat{F}\)是单值的，
可见\(\hat{F}\)确实是一个映射.
显然有\(\dom \hat{F} = A/\rel{R}\)，\(\ran \hat{F} \subseteq A/\rel{R}\)，
因此\(\hat{F}\)是从\(A/\rel{R}\)到\(A/\rel{R}\)的映射.
%TODO 没有给出唯一性的证明
\end{proof}
\end{theorem}
上述结论还可以推广到映射是\(F\colon A \times A \to A\)的情形.

\section{排序关系}
不同于等价关系，\DefineConcept{排序关系}（ordering relation）具有一些别致的性质.

\subsection{线性序}
\begin{definition}
设\(A\)是集合，\(\rel{R}\)是\(A\)上的一个二元关系.
如果\begin{enumerate}
	\item \(\rel{R}\)具有传递性，
	\item \(\rel{R}\)在\(A\)上服从\DefineConcept{三一律}（trichotomy），
	也就是说，对于\(\forall x,y \in A\)，
	在以下三个命题中，有且仅有一个是真命题：\[
		x \rel{R} y, \qquad
		x = y, \qquad
		y \rel{R} x;
	\]
	%@see: https://mathworld.wolfram.com/TrichotomyLaw.html
\end{enumerate}
那么称\(\rel{R}\)为%
“\(A\)上的\DefineConcept{线性序}（linear ordering）%
或\DefineConcept{全序}（total ordering）”.
\end{definition}

应该注意到，当\(x = y\)时，三一律要求\[
	x \rel{R} x, \qquad
	x = x, \qquad
	x \rel{R} x
\]中的一个成立，
考虑到\(x = x\)恒成立，
那么必有\(x \rel{R} x\)恒不成立.
易见当\(x \neq y\)时，必有\(x \rel{R} y\)或\(y \rel{R} x\)之一成立，
都不可能有\(x \rel{R} y\)和\(y \rel{R} x\)都成立.
于是我们证得如下定理.

\begin{theorem}
%@see: 《Elements of Set Theory》 P63. Theorem 3R
设\(\rel{R}\)是集合\(A\)上的线性序.
\begin{enumerate}
	\item {\rm \(\rel{R}\)具有\DefineConcept{反自反性}（irreflexive）}，
	即不存在\(x\)使得\(x \rel{R} x\).

	\item {\rm \(\rel{R}\)在\(A\)上是连通的（\(\rel{R}\) is \emph{connected} on \(A\)）}，
	即对于不同的\(x,y \in A\)，要么有\(x \rel{R} y\)成立，要么有\(y \rel{R} x\)成立.
\end{enumerate}
\end{theorem}

值得注意的是，
线性序\(\rel{R}\)永远不会给出如下的环形：
\begin{center}
	\begin{tikzpicture}
		\fill(1,0)circle(2pt)coordinate(A0);
		\fill({cos(72)},{sin(72)})circle(2pt)coordinate(A1);
		\fill({cos(144)},{sin(144)})circle(2pt)coordinate(A2);
		\fill({cos(216)},{sin(216)})circle(2pt)coordinate(A3);
		\fill({cos(288)},{sin(288)})circle(2pt)coordinate(A4);
		\begin{scope}[->]
			\draw(A0)arc[start angle=0,end angle=68,radius=1]node[midway,above right]{\(x_1 \rel{R} x_2\)};
			\draw(A1)arc[start angle=72,end angle=140,radius=1]node[midway,above left]{\(x_2 \rel{R} x_3\)};
			\draw(A2)arc[start angle=144,end angle=212,radius=1]node[midway,left]{\(x_3 \rel{R} x_4\)};
			\draw(A3)arc[start angle=216,end angle=284,radius=1]node[midway,below left]{\(x_4 \rel{R} x_5\)};
			\draw(A4)arc[start angle=288,end angle=356,radius=1]node[midway,below right]{\(x_5 \rel{R} x_1\)};
		\end{scope}
	\end{tikzpicture}
\end{center}
这是因为，如果我们有这样的环形成立，
那么根据传递性必有\(x_1 \rel{R} x_1\)，
而这就与反自反性矛盾！

\begin{example}
设\(\rel{R}\)是\(A\)上的一个线性序，
证明：\(\rel{R}^{-1}\)也是\(A\)上的线性序.
\begin{proof}
由于\[
	\bigl( x \rel{R} y \land y \rel{R} z \implies x \rel{R} z \bigr)
	\iff
	\bigl( y \rel{R}^{-1} x \land z \rel{R}^{-1} y \implies z \rel{R}^{-1} x \bigr),
\]
可知\(\rel{R}^{-1}\)具有传递性.
又因为\(\rel{R}\)是\(A\)上的线性序，
所以对于\(\forall x,y \in A\)，以下三个命题\[
	x \rel{R} y, \qquad
	x = y, \qquad
	y \rel{R} x
\]有且仅有一个成立；
换句话说，以下三个命题\[
	y \rel{R}^{-1} x, \qquad
	x = y, \qquad
	x \rel{R}^{-1} y
\]有且仅有一个成立；
可知\(\rel{R}^{-1}\)服从三一律.
综上所述，\(\rel{R}^{-1}\)也是\(A\)上的线性序.
\end{proof}
\end{example}

\subsection{偏序关系}
\begin{definition}
设\(\rel{R}\)是集合\(A\)上的二元关系，即\(\rel{R} \subseteq A^2\).
对于\(\forall x,y \in A\)，若\[
	x\rel{R}y \land y\rel{R}x \implies x = y,
\]
则称“关系\(\rel{R}\)具有\DefineConcept{反对称性}（antisymmetric）”.
\end{definition}

\begin{definition}
设\(\rel{R}\)是集合\(A\)上的二元关系，即\(\rel{R} \subseteq A^2\).
如果\(\rel{R}\)同时具有自反性、反对称性、传递性，
则称“\(\rel{R}\)是\(A\)上的\DefineConcept{偏序关系}（ordering relation）”.
\end{definition}

%\section{集合的大小}
%\begin{definition}
%一个集合所包含的元素的个数，称作集合的\DefineConcept{基数}（cardinal）、\DefineConcept{元数}或\DefineConcept{浓度}，记作\(\card(A)\)或\(\abs{A}\).
%\end{definition}
%
%\begin{definition}
%只含有限个元素的集合称为\DefineConcept{有限集}（finite set）.
%不是有限集的集合称为\DefineConcept{无限集}（infinite set）.
%\end{definition}
%
%\begin{property}
%有限集\(A\)对应的幂集的大小为\[
%	\abs{\Powerset A} = 2^{\abs{A}}.
%\]
%%TODO
%%\begin{proof}
%%\end{proof}
%\end{property}
%
%\begin{example}
%设\(A\)、\(B\)是任意两个集合，试证：
%\(\abs{A \cup B} + \abs{A \cap B} = \abs{A} + \abs{B}\).
%%TODO
%\end{example}
